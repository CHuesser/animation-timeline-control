!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.timelineModule=t():e.timelineModule=t()}(window,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}([function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.r(t),n.d(t,"Timeline",(function(){return de})),n.d(t,"TimelineModel",(function(){return ve.TimelineModel})),n.d(t,"TimelineRow",(function(){return pe.TimelineRow})),n.d(t,"TimelineKeyframe",(function(){return ye.TimelineKeyframe})),n.d(t,"TimelineEventsEmitter",(function(){return r})),n.d(t,"TimelineConsts",(function(){return me.TimelineConsts})),n.d(t,"TimelineOptions",(function(){return ge.TimelineOptions})),n.d(t,"TimelineKeyframeStyle",(function(){return we.TimelineKeyframeStyle})),n.d(t,"TimelineRowStyle",(function(){return xe.TimelineRowStyle})),n.d(t,"TimelineStyle",(function(){return ke.TimelineStyle})),n.d(t,"TimelineStyleUtils",(function(){return v})),n.d(t,"TimelineUtils",(function(){return c})),n.d(t,"TimelineElement",(function(){return be.TimelineElement})),n.d(t,"Selectable",(function(){return Se.Selectable})),n.d(t,"CutBoundsRect",(function(){return Te.CutBoundsRect})),n.d(t,"TimelineModelCalcResults",(function(){return Ce.TimelineModelCalcResults})),n.d(t,"TimelineCalculatedRow",(function(){return Ce.TimelineCalculatedRow})),n.d(t,"TimelineCalculatedGroup",(function(){return Ce.TimelineCalculatedGroup})),n.d(t,"TimelineCalculated",(function(){return Ce.TimelineCalculated})),n.d(t,"TimelineCalculatedKeyframe",(function(){return Ce.TimelineCalculatedKeyframe})),n.d(t,"TimelineSelectedEvent",(function(){return C})),n.d(t,"TimelineScrollEvent",(function(){return Pe.TimelineScrollEvent})),n.d(t,"TimelineClickEvent",(function(){return K})),n.d(t,"TimelineDragEvent",(function(){return N})),n.d(t,"TimelineTimeChangedEvent",(function(){return ie})),n.d(t,"TimelineEvents",(function(){return f})),n.d(t,"TimelineKeyframeShape",(function(){return a})),n.d(t,"TimelineInteractionMode",(function(){return d})),n.d(t,"TimelineElementType",(function(){return h})),n.d(t,"TimelineCursorType",(function(){return l})),n.d(t,"TimelineCapShape",(function(){return _})),n.d(t,"TimelineEventSource",(function(){return H})),n.d(t,"defaultTimelineOptions",(function(){return Z})),n.d(t,"defaultTimelineKeyframeStyle",(function(){return G})),n.d(t,"defaultTimelineRowStyle",(function(){return U})),n.d(t,"defaultTimelineStyle",(function(){return I})),n.d(t,"defaultTimelineConsts",(function(){return Y}));var r=function(){function e(){var t,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=[],(n="_subscriptions")in(t=this)?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i}var t,n,r;return t=e,(n=[{key:"on",value:function(e,t){t&&this._subscriptions.push({topic:e,callback:t})}},{key:"off",value:function(e,t){this._subscriptions=this._subscriptions.filter((function(n){return n&&n.callback!=t&&n.topic!=e}))}},{key:"offAll",value:function(){this._subscriptions.length=0}},{key:"emit",value:function(e,t){this._subscriptions.forEach((function(n){n&&n.topic==e&&n.callback&&n.callback(t)}))}}])&&i(t.prototype,n),r&&i(t,r),e}();function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l,a,s=[1,2,5,10],c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"drawLine",value:function(e,t,n,i,r){e.moveTo(t,n),e.lineTo(i,r)}},{key:"isOverlap",value:function(e,t,n){return!!n&&n.x<=e&&n.x+n.width>=e&&n.y<=t&&n.y+n.height>=t}},{key:"findGoodStep",value:function(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=t,r=null,o=e.getPowArgument(t),l=0;l<s.length;l++){var a=s[l],c=a*Math.pow(10,o);if(!n||n%c==0){var u=e.getDistance(t,c);if(0==u||u<=.1&&o>0){r=u,i=c;break}(!r||r>u)&&(r=u,i=c)}}return i}},{key:"isRectOverlap",value:function(e,t){return e&&t?e.x>t.x+t.width||t.x>e.x+e.width||e.y<t.y+t.height||t.y<e.y+e.height:(console.log("Rectangles cannot be empty"),!1)}},{key:"getDistance",value:function(e,t,n,i){return null!=n&&null!=i?Math.sqrt(Math.pow(e-n,2)+Math.pow(t-i,2)):Math.abs(e-t)}},{key:"sign",value:function(e){return e>=0?1:-1}},{key:"clearBrowserSelection",value:function(){if(window)if(window.getSelection)window.getSelection().removeAllRanges();else{var e=window.document;e.selection&&e.selection.empty()}}},{key:"getPowArgument",value:function(e){if(!e||0===e||!isFinite(e))return 1;if(e>=10&&e<100)return 1;if(e>=100&&e<1e3)return 2;if(e>=1e3&&e<1e4)return 3;e=Math.abs(e);var t=0,n=this.sign(e);if(e>1){for(;e>=1;)e=Math.floor(e/10),t++;return n*t-1}return e>0?Math.floor(Math.log(e)/Math.log(10)+1)-1:1}}],(n=null)&&o(t.prototype,n),i&&o(t,i),e}();function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}!function(e){e.Alias="alias",e.AllScroll="all-scroll",e.Auto="auto",e.Cell="cell",e.ContextMenu="context-menu",e.ColResize="col-resize",e.Copy="copy",e.Crosshair="crosshair",e.Default="default",e.EResize="e-resize",e.EWResize="ew-resize",e.Grab="grab",e.Grabbing="grabbing",e.Help="help",e.Move="move",e.NResize="n-resize",e.NEResize="ne-resize",e.NESWResize="nesw-resize",e.NSResize="ns-resize",e.NWResize="nw-resize",e.NWSEResize="nwse-resize",e.NoDrop="no-drop",e.None="none",e.NotAllowed="not-allowed",e.Pointer="pointer",e.Progress="progress",e.RowResize="row-resize",e.SResize="s-resize",e.SEResize="se-resize",e.SWResize="sw-resize",e.Text="text",e.WResize="w-resize",e.Wait="wait",e.ZoomIn="zoom-in",e.ZoomOut="zoom-out"}(l||(l={})),function(e){e.None="none",e.Rhomb="rhomb",e.Circle="circle",e.Rect="rect"}(a||(a={}));var h,f,_,d,v=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"getKeyframeStyle",value:function(e,t,n,i,r){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=null;if(e){var a=e;if(void 0!==a[i]){var s=a[i];if(!o)return s;(l=l||[]).push(s)}}if(t&&t.keyframesStyle){var c=t.keyframesStyle;if(void 0!==c[i]){var u=c[i];if(!o)return u;(l=l||[]).push(u)}}var h=n?n.rowsStyle:null;if(h&&h.keyframesStyle){var f=h.keyframesStyle;if(void 0!==f[i]){var _=f[i];if(!o)return _;(l=l||[]).push(_)}}return o&&l&&l.length>0?l[l.length-1]:r}},{key:"getRowStyle",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=null;if(e){var l=e;if(void 0!==l[n]){var a=l[n];if(!r)return a;(o=o||[]).push(a)}}var s=t?t.rowsStyle:null;if(s){var c=s;if(void 0!==c[n]){var u=c[n];if(!r)return u;(o=o||[]).push(u)}}return r&&o&&o.length>0?o[o.length-1]:i}},{key:"keyframeShape",value:function(t,n,i){return e.getKeyframeStyle(t,n,i,"shape",a.Rhomb)}},{key:"keyframeFillColor",value:function(t,n,i){return e.getKeyframeStyle(t,n,i,"fillColor","DarkOrange")}},{key:"keyframeSelectedFillColor",value:function(t,n,i){return e.getKeyframeStyle(t,n,i,"selectedFillColor","red")}},{key:"keyframeStrokeThickness",value:function(t,n,i){return e.getKeyframeStyle(t,n,i,"strokeThickness",.2,!1)}},{key:"keyframeStrokeColor",value:function(t,n,i){return e.getKeyframeStyle(t,n,i,"strokeColor","Black",!1)}},{key:"getRowHeight",value:function(t,n){return e.getRowStyle(t,n,"height",24)}},{key:"rowGroupHeight",value:function(t,n){return e.getRowStyle(t,n,"groupHeight","auto")}},{key:"groupFillColor",value:function(t,n){return e.getRowStyle(t,n,"groupFillColor")}},{key:"getRowMarginBottom",value:function(t,n){return e.getRowStyle(t,n,"marginBottom",0)}},{key:"getRowFillColor",value:function(t,n){return e.getRowStyle(t,n,"fillColor","#252526")}},{key:"keyframeDraggable",value:function(t,n,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return e.getKeyframeStyle(t,n,i,"draggable",r,!0)}},{key:"groupDraggable",value:function(t,n){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.getRowStyle(t,n,"groupDraggable",i,!0)}}],(n=null)&&u(t.prototype,n),i&&u(t,i),e}();function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}!function(e){e.Timeline="timeline",e.Keyframe="keyframe",e.Group="group",e.Row="row"}(h||(h={})),function(e){e.Selected="selected",e.TimeChanged="timechanged",e.DragStarted="dragstarted",e.Drag="drag",e.DragFinished="dragfinished",e.Scroll="scroll",e.DoubleClick="doubleclick",e.MouseDown="mousedown"}(f||(f={})),function(e){e.None="none",e.Triangle="triangle",e.Rect="rect"}(_||(_={})),function(e){e.Selection="selection",e.Pan="pan"}(d||(d={}));var y=function(){function e(){var t,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=!1,(n="_prevented")in(t=this)?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i}var t,n,i;return t=e,(n=[{key:"preventDefault",value:function(){this._prevented=!0}},{key:"isPrevented",value:function(){return this._prevented}}])&&p(t.prototype,n),i&&p(t,i),e}();function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=S(e);if(t){var r=S(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return k(this,n)}}function k(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?b(e):t}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(n,e);var t=x(n);function n(){var e;g(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return T(b(e=t.call.apply(t,[this].concat(r))),"keyframes",void 0),e}return n}(y);function P(e){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=z(e);if(t){var r=z(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return D(this,n)}}function D(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?O(e):t}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z(e){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var K=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(n,e);var t=E(n);function n(){var e;M(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return W(O(e=t.call.apply(t,[this].concat(r))),"args",void 0),W(O(e),"pos",void 0),W(O(e),"val",void 0),W(O(e),"elements",void 0),W(O(e),"target",void 0),e}return n}(y);function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function V(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=B(e);if(t){var r=B(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return F(this,n)}}function F(e,t){return!t||"object"!==L(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var H,N=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(n,e);var t=A(n);function n(){return V(this,n),t.apply(this,arguments)}return n}(K),I={width:2,marginTop:15,capWidth:4,capHeight:10,capType:_.Rect,strokeColor:"DarkOrange",fillColor:"DarkOrange"},G={fillColor:"red",shape:a.Rhomb,selectedFillColor:"DarkOrange",strokeColor:"Black",strokeThickness:.2,draggable:!0},U={height:24,marginBottom:2,fillColor:"#252526",groupFillColor:"#094771",groupHeight:"auto",keyframesStyle:G},Z={snapsPerSeconds:5,snapAllKeyframesOnMove:!1,snapEnabled:!0,timelineStyle:I,stepPx:120,stepSmallPx:30,smallSteps:50,leftMargin:25,headerFillColor:"#101011",fillColor:"#101011",labelsColor:"#D5D5D5",tickColor:"#D5D5D5",selectionColor:"White",rowsStyle:U,headerHeight:30,font:"11px sans-serif",zoom:1e3,zoomSpeed:.1,zoomMin:80,zoomMax:8e3,controlKeyIsMetaKey:!1,scrollContainerClass:"scroll-container",groupsDraggable:!0,keyframesDraggable:!0},Y={autoPanSpeed:50,scrollByDragSpeed:.12,clickDetectionMs:120,doubleClickTimeoutMs:400,scrollFinishedTimeoutMs:500,autoPanByScrollPadding:10,clickThreshold:3};function X(e){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function J(e,t){return(J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=te(e);if(t){var r=te(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return $(this,n)}}function $(e,t){return!t||"object"!==X(t)&&"function"!=typeof t?ee(e):t}function ee(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function te(e){return(te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.User="user",e.Programmatically="programmatically",e.SetTimeMethod="setTimeMethod"}(H||(H={}));var ie=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}(n,e);var t=Q(n);function n(){var e;q(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return ne(ee(e=t.call.apply(t,[this].concat(r))),"val",0),ne(ee(e),"prevVal",0),ne(ee(e),"source",H.User),e}return n}(y);function re(e){return(re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function oe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function le(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ae(e,t){return(ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=fe(e);if(t){var r=fe(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return ce(this,n)}}function ce(e,t){return!t||"object"!==re(t)&&"function"!=typeof t?ue(e):t}function ue(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function he(e,t,n){return(he="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=fe(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function fe(e){return(fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var de=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}(o,e);var t,n,i,r=se(o);function o(){var e,t,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return oe(this,o),_e(ue(n=r.call(this)),"_container",null),_e(ue(n),"_canvas",null),_e(ue(n),"_scrollContainer",null),_e(ue(n),"_scrollContent",null),_e(ue(n),"_ctx",null),_e(ue(n),"_options",null),_e(ue(n),"_startPos",null),_e(ue(n),"_scrollStartPos",{x:0,y:0}),_e(ue(n),"_currentPos",null),_e(ue(n),"_selectionRect",null),_e(ue(n),"_selectionRectEnabled",!1),_e(ue(n),"_drag",null),_e(ue(n),"_startedDragWithCtrl",!1),_e(ue(n),"_startedDragWithShiftKey",!1),_e(ue(n),"_clickTimeout",0),_e(ue(n),"_lastClickTime",0),_e(ue(n),"_lastClickPoint",null),_e(ue(n),"_consts",Y),_e(ue(n),"_clickAllowed",!1),_e(ue(n),"_scrollFinishedTimerRef",null),_e(ue(n),"_val",0),_e(ue(n),"_pixelRatio",1),_e(ue(n),"_currentZoom",0),_e(ue(n),"_intervalRef",null),_e(ue(n),"_autoPanLastActionDate",0),_e(ue(n),"_isPanStarted",!1),_e(ue(n),"_interactionMode",d.Selection),_e(ue(n),"_lastUsedArgs",null),_e(ue(n),"_model",null),_e(ue(n),"_handleBlurEvent",(function(){n._cleanUpSelection()})),_e(ue(n),"_handleWindowResizeEvent",(function(){n.rescale(),n.redraw()})),_e(ue(n),"_handleScrollEvent",(function(e){n._clearScrollFinishedTimer(),n._scrollFinishedTimerRef=setTimeout((function(){n._isPanStarted||(n._scrollFinishedTimerRef&&(clearTimeout(n._scrollFinishedTimerRef),n._scrollFinishedTimerRef=null),n.rescale(),n.redraw())}),n._consts.scrollFinishedTimeoutMs),n.redraw(),n._emitScrollEvent(e)})),_e(ue(n),"_handleWheelEvent",(function(e){if(n._controlKeyPressed(e)){if(e.preventDefault(),n._options.zoomSpeed>0&&n._options.zoomSpeed<=1){var t=n._getMousePos(n._canvas,e).x;t<=0&&(t=0);var i=n.pxToVal(n._scrollContainer.scrollLeft+t,!1),r=n._canvas.clientWidth/t,o=c.sign(e.deltaY)*n._options.zoom*n._options.zoomSpeed;n._currentZoom+=o,n._currentZoom>n._options.zoomMax&&(n._currentZoom=n._options.zoomMax),n._currentZoom<n._options.zoomMin&&(n._currentZoom=n._options.zoomMin);var l=n.valToPx(i,!0),a=Math.round(l-n._canvas.clientWidth/r);a<=0&&(a=0),n._rescaleInternal(a+n._canvas.clientWidth,null,"zoom"),n._scrollContainer.scrollLeft!=a&&(n._scrollContainer.scrollLeft=a),n.redraw()}}else n._scrollContainer.scrollTop+=e.deltaY,e.preventDefault()})),_e(ue(n),"_handleMouseDownEvent",(function(i){var r=Date.now()-n._lastClickTime<n._consts.doubleClickTimeoutMs;if(c.clearBrowserSelection(),n._startPos=n._trackMousePos(n._canvas,i),n._startPos){n._lastClickPoint&&n._startPos&&c.getDistance(n._lastClickPoint.x,n._lastClickPoint.y,n._startPos.x,n._startPos.y)>n._consts.clickThreshold&&(r=!1),n._lastClickPoint=n._startPos,n._scrollStartPos={x:n._scrollContainer.scrollLeft,y:n._scrollContainer.scrollTop},n._clickAllowed=!0;var l=n.elementFromPoint(n._startPos,Math.max(2,n._startPos.radius)),a=n._findDraggable(l,n._startPos.val),s=new K;if(s.pos=n._startPos,s.val=n._startPos.val,s.args=i,s.elements=l,s.target=a,r)he((e=ue(n),fe(o.prototype)),"emit",e).call(e,f.DoubleClick,s);else if(he((t=ue(n),fe(o.prototype)),"emit",t).call(t,f.MouseDown,s),n._clickTimeout=Date.now(),n._lastClickTime=Date.now(),s.isPrevented())n._cleanUpSelection();else{if(n._currentPos=n._startPos,a)if(n._drag={changed:!1,target:a,val:a.val,type:a.type,elements:[]},a.type===h.Keyframe)n._startedDragWithCtrl=n._controlKeyPressed(i),n._startedDragWithShiftKey=i.shiftKey,a.keyframe.selected||n._controlKeyPressed(i)||i.shiftKey||n._performSelection(!0,a.keyframe),n._drag.elements=n.getSelectedElements();else if(a.type===h.Group){var u=n._drag.target.keyframes;n._drag.elements=u&&Array.isArray(u)?u.map((function(e){return n._convertToElement(n._drag.target.row,e)})):[]}else n._drag.elements=[n._drag.target];n.redraw()}}})),_e(ue(n),"_handleMouseMoveEvent",(function(e){if(e?n._lastUsedArgs=e:e=n._lastUsedArgs,e){var t=e.changedTouches&&e.changedTouches.length>0;n._currentPos=n._trackMousePos(n._canvas,e),!n._isPanStarted&&n._selectionRect&&n._clickTimeoutIsOver()?n._selectionRectEnabled=!0:n._selectionRectEnabled=!1,e=e;var i=n.isLeftButtonClicked(e);if(n._startPos)if(i||t){var r=!1;if(n._drag&&!n._startedDragWithCtrl){var o=n._mousePosToVal(n._currentPos.x,!0);if(n._drag.type===h.Timeline)r=n._setTimeInternal(o,H.User)||r;else if((n._drag.type==h.Keyframe||n._drag.type==h.Group)&&n._drag.elements){var a=Math.floor(o-n._drag.val);Math.abs(a)>0&&(n._drag.elements.forEach((function(e){if(n._options.snapAllKeyframesOnMove){var t=n.snapVal(e.keyframe.val);r=n._setKeyframePos(e.keyframe,t)||r}e.val+a<0&&(a=-e.val)})),Math.abs(a)>0&&n._drag.elements.forEach((function(e){var t=e.keyframe.val+a;(r=n._setKeyframePos(e.keyframe,t)||r)&&(e.val=e.keyframe.val)})),r&&(n._drag.changed||n._emitDragStartedEvent(),n._drag.changed=!0,n._drag.val+=a,n._emitDragEvent()))}}n._interactionMode!==d.Pan||n._drag?n._scrollBySelectionOutOfBounds(n._currentPos):(n._isPanStarted=!0,n._setCursor(l.Grabbing),n._scrollByPan(n._startPos,n._currentPos,n._scrollStartPos)),n.redraw()}else n._cleanUpSelection(),n.redraw();else if(!t){var s=n.elementFromPoint(n._currentPos,Math.max(2,n._currentPos.radius)),c=n._findDraggable(s,n._currentPos.val);if(n._isPanStarted||n._interactionMode===d.Pan?i?n._setCursor(l.Grabbing):n._setCursor(l.Grab):n._setCursor(l.Default),c){var u=null;c.type===h.Group?u=u||l.EWResize:c.type==h.Keyframe?u=u||l.Pointer:c.type==h.Timeline&&(u=u||l.EWResize),u&&n._setCursor(u)}}t&&e.preventDefault()}})),_e(ue(n),"_handleMouseUpEvent",(function(e){if(n._startPos){var t=n._trackMousePos(n._canvas,e);n._clickAllowed||!n._clickTimeoutIsOver()||n._drag&&n._startedDragWithCtrl||n._drag&&n._startedDragWithShiftKey?n._performClick(t,e,n._drag):!n._drag&&n._selectionRect&&n._selectionRectEnabled&&n._performSelection(!0,n._selectionRect,e.shiftKey),n._cleanUpSelection(),n.redraw()}})),_e(ue(n),"_redrawInternal",(function(){n._ctx&&(n.valToPx(n._val,!0)>n._scrollContainer.scrollWidth&&(n.rescale(),!n._isPanStarted&&n._drag&&n._drag.type!==h.Timeline&&n.scrollLeft()),n._renderBackground(),n._renderRows(),n._renderHeaderBackground(),n._renderTicks(),n._renderKeyframes(),n._renderSelectionRect(),n._renderTimeline())})),(i||a)&&n.initialize(i,a),n}return t=o,(n=[{key:"initialize",value:function(e,t){if(this._model=t,!e||!e.id)throw new Error("Element cannot be empty. Should be string or DOM element.");var n=e.id;if(this._options=this._mergeOptions(e),this._currentZoom=this._options.zoom,n instanceof HTMLElement?this._container=n:this._container=document.getElementById(n),!this._container)throw new Error("Element cannot be empty. Should be string or DOM element.");if(this._scrollContainer=document.createElement("div"),this._scrollContent=document.createElement("div"),this._canvas=document.createElement("canvas"),!this._canvas||!this._canvas.getContext)return console.log("Cannot initialize canvas context."),null;this._container.style.position="relative",this._canvas.style.cssText="image-rendering: -moz-crisp-edges;image-rendering: -webkit-crisp-edges;image-rendering: pixelated;image-rendering: crisp-edges;user-select: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-o-user-select: none;user-select: none;touch-action: none;position: relative;-webkit-user-drag: none;-khtml-user-drag: none;-moz-user-drag: none;-o-user-drag: none;user-drag: none;padding: inherit",this._scrollContainer.classList.add(this._options.scrollContainerClass),this._scrollContainer.style.cssText="overflow: scroll;position: absolute;width:  100%;height:  100%;",this._scrollContent.style.width=this._scrollContent.style.height="100%",this._scrollContainer.appendChild(this._scrollContent),this._container.appendChild(this._scrollContainer);var i=this._scrollContainer.offsetWidth-this._scrollContent.clientWidth;this._canvas.style.width=this._canvas.style.height="calc(100% -"+(i||17)+"px)",this._container.appendChild(this._canvas),this._options.fillColor&&(this._scrollContainer.style.background=this._options.fillColor),this._options.snapsPerSeconds=Math.max(0,Math.min(60,this._options.snapsPerSeconds||0)),this._ctx=this._canvas.getContext("2d"),this._subscribeOnEvents(),this.rescale(),this.redraw()}},{key:"_subscribeOnEvents",value:function(){this._container.addEventListener("wheel",this._handleWheelEvent),this._scrollContainer&&this._scrollContainer.addEventListener("scroll",this._handleScrollEvent),window.addEventListener("blur",this._handleBlurEvent,!1),window.addEventListener("resize",this._handleWindowResizeEvent,!1),this._canvas.addEventListener("touchstart",this._handleMouseDownEvent,!1),this._canvas.addEventListener("mousedown",this._handleMouseDownEvent,!1),window.addEventListener("mousemove",this._handleMouseMoveEvent,!1),window.addEventListener("touchmove",this._handleMouseMoveEvent,!1),window.addEventListener("mouseup",this._handleMouseUpEvent,!1),window.addEventListener("touchend",this._handleMouseUpEvent,!1)}},{key:"dispose",value:function(){this.offAll(),this._container=null,this._canvas=null,this._scrollContainer=null,this._scrollContent=null,this._ctx=null,this._cleanUpSelection(),this._container.removeEventListener("wheel",this._handleWheelEvent),this._scrollContainer&&this._scrollContainer.removeEventListener("scroll",this._handleScrollEvent),window.removeEventListener("blur",this._handleBlurEvent),window.removeEventListener("resize",this._handleWindowResizeEvent),this._canvas.removeEventListener("touchstart",this._handleMouseDownEvent),this._canvas.removeEventListener("mousedown",this._handleMouseDownEvent),window.removeEventListener("mousemove",this._handleMouseMoveEvent),window.removeEventListener("touchmove",this._handleMouseMoveEvent),window.removeEventListener("mouseup",this._handleMouseUpEvent),window.removeEventListener("touchend",this._handleMouseUpEvent),this._stopAutoPan(),this._clearScrollFinishedTimer()}},{key:"selectAllKeyframes",value:function(){this._performSelection(!0)&&(this.rescale(),this.redraw())}},{key:"_clearScrollFinishedTimer",value:function(){this._scrollFinishedTimerRef&&(clearTimeout(this._scrollFinishedTimerRef),this._scrollFinishedTimerRef=null)}},{key:"_controlKeyPressed",value:function(e){return this._options.controlKeyIsMetaKey||this._options.controlKeyIsMetaKey?e.metaKey:e.ctrlKey}},{key:"isLeftButtonClicked",value:function(e){return!!e&&1==e.buttons}},{key:"_performClick",value:function(e,t,n){var i=!1;if(n&&n.type===h.Keyframe){var r=!0;if((this._startedDragWithCtrl&&this._controlKeyPressed(t)||this._startedDragWithShiftKey&&t.shiftKey)&&this._controlKeyPressed(t)&&(r=!n.target.keyframe.selected),i=this._performSelection(r,this._drag.target.keyframe,this._controlKeyPressed(t)||t.shiftKey)||i,t.shiftKey){var o=this._mousePosToVal(e.x,!0);i=this._setTimeInternal(o,H.User)||i}}else i=this._performSelection(!1)||i,i=this._setTimeInternal(this._mousePosToVal(e.x,!0),H.User)||i;return i}},{key:"_setKeyframePos",value:function(e,t){return t=Math.floor(t),!(!e||e.val==t||(e.val=t,0))}},{key:"_setCursor",value:function(e){this._canvas.style.cursor!=e&&(this._canvas.style.cursor=e)}},{key:"setInteractionMode",value:function(e){this._interactionMode!=e&&(this._interactionMode=e,this._cleanUpSelection())}},{key:"getInteractionMode",value:function(){return this._interactionMode}},{key:"_convertToElement",value:function(e,t){return{type:h.Keyframe,val:t.val,keyframe:t,row:e}}},{key:"getSelectedElements",value:function(){var e=this,t=[];return this._forEachKeyframe((function(n){n&&n.model.selected&&t.push(e._convertToElement(n.parentRow.model,n.model))})),t}},{key:"_performSelection",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!1;t||(e||(e=!1),i=e);var r=[],o=!0;return this._forEachKeyframe((function(l){var a=l.size,s=l.model;a&&(t&&t===s||c.isOverlap(a.x,a.y,t)?(s.selected!=e&&e&&s&&(s.selected=e,o=!0),s.selected&&r.push(s)):n||s.selected==i||(s.selected=i,o=i))})),o&&this._emitKeyframesSelected(r),o}},{key:"_forEachKeyframe",value:function(e){if(e&&this._model){var t=this._calculateModel();t&&t.rows.forEach((function(t){if(t){var n=!0;t.keyframes.forEach((function(t,i){t&&e(t,i,n),n=!1}))}}))}}},{key:"_trackMousePos",value:function(e,t){var n=this._getMousePos(e,t);if(n.val=this.pxToVal(n.x+this._scrollContainer.scrollLeft),n.snapVal=this.snapVal(n.val),this._startPos){this._selectionRect||(this._selectionRect={});var i=Math.floor(this._startPos.x+(this._scrollStartPos.x-this._scrollContainer.scrollLeft)),r=Math.floor(this._startPos.y+(this._scrollStartPos.y-this._scrollContainer.scrollTop));this._selectionRect.x=Math.min(i,n.x),this._selectionRect.y=Math.min(r,n.y),this._selectionRect.width=Math.max(i,n.x)-this._selectionRect.x,this._selectionRect.height=Math.max(r,n.y)-this._selectionRect.y,this._clickAllowed&&(this._clickAllowed=this._selectionRect.height<=this._consts.clickThreshold&&this._selectionRect.width<=this._consts.clickThreshold)}return n}},{key:"_cleanUpSelection",value:function(){this._emitDragFinishedEvent(),this._startPos=null,this._drag=null,this._startedDragWithCtrl=!1,this._startedDragWithShiftKey=!1,this._selectionRect=null,this._clickTimeout=null,this._scrollStartPos=null,this._isPanStarted=!1,this._clickAllowed=!1,this._stopAutoPan()}},{key:"_clickTimeoutIsOver",value:function(){return!!(this._clickTimeout&&Date.now()-this._clickTimeout>this._consts.clickDetectionMs)}},{key:"_startAutoPan",value:function(){var e=this;this._consts.autoPanSpeed&&(this._intervalRef||(this._intervalRef=setInterval((function(){e._handleMouseMoveEvent(null)}),this._consts.autoPanSpeed)))}},{key:"_stopAutoPan",value:function(){this._intervalRef&&(clearInterval(this._intervalRef),this._intervalRef=null),this._autoPanLastActionDate=null}},{key:"_checkUpdateSpeedTooFast",value:function(){return!!(this._autoPanLastActionDate&&Date.now()-this._autoPanLastActionDate<=10)||(this._autoPanLastActionDate=Date.now(),!1)}},{key:"_scrollByPan",value:function(e,t,n){if(e&&t){var i=Math.round(e.x-t.x),r=n.x+i;i>0&&this._rescaleInternal(r+this._canvas.clientWidth),i>0&&r+this._canvas.clientWidth>=this._scrollContainer.scrollWidth-5?this._scrollContainer.scrollLeft=this._scrollContainer.scrollWidth:this._scrollContainer.scrollLeft=r,this._scrollContainer.scrollTop=Math.round(n.y+e.y-t.y)}}},{key:"_scrollBySelectionOutOfBounds",value:function(e){var t=e.x,n=e.y,i=!1,r=0,o=0,l=this._consts.autoPanByScrollPadding,a=t<=l,s=t>=this._canvas.clientWidth-l,u=n<=l,h=n>=this._canvas.clientHeight-l,f=null,_=null;if(a||s||u||h){if(this._startAutoPan(),this._checkUpdateSpeedTooFast())return!1;var d=isNaN(this._consts.scrollByDragSpeed)?1:this._consts.scrollByDragSpeed;a?r=-c.getDistance(t,l)*d:s&&(r=c.getDistance(t,this._canvas.clientWidth-l)*d,f=this._scrollContainer.scrollLeft+this._canvas.clientWidth+r),u?o=-c.getDistance(t,l)*d/4:h&&(o=c.getDistance(t,this._canvas.clientHeight-l)*d/4,_=this._scrollContainer.scrollTop+this._canvas.clientHeight)}else this._stopAutoPan();return(f||_)&&this._rescaleInternal(f,_,"scrollBySelection"),Math.abs(r)>0&&(this._scrollContainer.scrollLeft+=r,i=!0),Math.abs(o)>0&&(this._scrollContainer.scrollTop+=o,i=!0),i}},{key:"pxToVal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t||(e-=this._options.leftMargin);var n=e/this._options.stepPx*this._options.zoom;return n}},{key:"valToPx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t){var n=this._scrollContainer.scrollLeft;e-=this.pxToVal(n)}return e*this._options.stepPx/this._options.zoom}},{key:"snapVal",value:function(e){if(this._options.snapsPerSeconds&&this._options.snapEnabled){var t=1e3/this._options.snapsPerSeconds,n=e/t,i=Math.round(n);e=Math.round(i*t)}return e<0&&(e=0),e}},{key:"_mousePosToVal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.pxToVal(this._scrollContainer.scrollLeft+Math.min(e,this._canvas.clientWidth));return n=Math.round(n),t&&(n=this.snapVal(n)),n}},{key:"_formatLineGaugeText",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e/1e3;t&&(n=e);var i=Math.floor(n/31536e3);n%=31536e3;var r=Math.floor(n/86400);n%=86400;var o=Math.floor(n/3600);n%=3600;var l=Math.floor(n/60);n%=60;var a="";return i&&(a+=i+":"),r&&(a+=r+":"),o&&(a+=o+":"),l&&(a+=l+":"),isNaN(n)||(a+=n),a}},{key:"_renderTicks",value:function(){if(this._ctx&&this._options){this._ctx.save();var e=this._scrollContainer.scrollWidth-(this._options.leftMargin||0),t=this.pxToVal(0),n=this.pxToVal(e),i=c.getDistance(t,n);if(0!==i){var r=i/(e/this._options.stepPx),o=c.findGoodStep(r);if(0!=o&&!isNaN(o)&&isFinite(o)){var l=o/(e/(i/o)/this._options.stepSmallPx),a=c.findGoodStep(l,o);o%a!=0&&(a=l);var s=this.pxToVal(this._scrollContainer.scrollLeft+this._options.leftMargin||0),u=this.pxToVal(this._scrollContainer.scrollLeft+this._scrollContainer.clientWidth);t=Math.floor(s/o)*o,n=Math.ceil(u/o)*o+o;for(var h=null,f=t;f<=n;f+=o){var _=this.valToPx(f),d=this._getSharp(Math.round(_));this._ctx.save(),this._ctx.beginPath(),this._ctx.setLineDash([4]),this._ctx.lineWidth=1,this._ctx.strokeStyle=this._options.tickColor,c.drawLine(this._ctx,d,(this._options.headerHeight||0)/2,d,this._canvas.clientHeight),this._ctx.stroke(),this._ctx.fillStyle=this._options.labelsColor,this._options.font&&(this._ctx.font=this._options.font);var v=this._formatLineGaugeText(f),p=this._ctx.measureText(v),y=d-p.width/2;(isNaN(h)||h<=y)&&(h=y+p.width,this._ctx.fillText(v,y,10)),this._ctx.restore();for(var m=f+a;m<f+o;m+=a){var g=this.valToPx(m),w=this._getSharp(Math.floor(g));this._ctx.beginPath(),this._ctx.lineWidth=this._pixelRatio,this._ctx.strokeStyle=this._options.tickColor,c.drawLine(this._ctx,w,(this._options.headerHeight||0)/1.3,w,this._options.headerHeight),this._ctx.stroke()}}this._ctx.restore()}}}}},{key:"_setMinMax",value:function(e,t){if(!t||!e)return e;if(null!==e.minValue&&null!==t.minValue){var n=Math.min(t.minValue,e.minValue);e.minValue=n}else null!==t.minValue&&(e.minValue=t.minValue);null!==e.maxValue&&null!==t.maxValue?e.maxValue=Math.min(t.maxValue,e.maxValue):null!==t.maxValue&&(e.maxValue=t.maxValue)}},{key:"_calculateModel",value:function(){var e=this,t={rows:[],size:{x:0,y:0,width:0,height:0},minValue:null,maxValue:null,keyframes:[]};if(!this._model)return t;var n=this._model.rows;if(!n||!Array.isArray(n)||n.length<=0)return t;var i=this._options.headerHeight;return n.forEach((function(n,r){if(n&&!n.hidden){var o=v.getRowHeight(n,e._options),l=v.getRowMarginBottom(n,e._options),a=i-e._scrollContainer.scrollTop;i+=o+l,0==r&&(t.size.y=a),t.size.height=Math.max(i+o,t.size.height);var s={x:0,y:a,width:e._canvas.clientWidth,height:o},c={size:s,marginBottom:l,model:n,minValue:null,maxValue:null,groups:[],keyframes:[]};t.rows.push(c),!n.keyframes||!n.keyframes.forEach||n.keyframes.length<=0||(n&&n.keyframes&&n.keyframes.forEach((function(n){if(n&&!isNaN(n.val)&&!n.hidden){for(var i=null,r=0;r<c.groups.length;r++){var o=c.groups[r];if(n.group===o.group){i=o;break}}i||(i={minValue:null,maxValue:null,group:n.group,keyframes:[]},c.groups.push(i));var l=e._getKeyframePosition(n,c),a={model:n,parentRow:c,parentGroup:i,size:l},s=null==i.minValue?n.val:Math.min(n.val,i.minValue),u=null==i.maxValue?n.val:Math.max(n.val,i.maxValue);isNaN(s)||(i.minValue=s),isNaN(u)||(i.maxValue=u),c.keyframes.push(a),i.keyframes.push(a),t.keyframes.push(a)}})),c.groups.forEach((function(t){e._setMinMax(c,t);var i=e._getKeyframesGroupSize(n,s.y,t.minValue,t.maxValue);t.size=i})),e._setMinMax(t,c))}})),null!==t.maxValue&&(t.size.width=this.valToPx(t.maxValue,!0)),t}},{key:"_renderRows",value:function(){var e=this,t=this._calculateModel();t&&t.rows&&(this._ctx.save(),t.rows.forEach((function(t){if(t){e._ctx.fillStyle=v.getRowFillColor(t.model,e._options);var n=e._cutBounds(t.size);n&&e._ctx.fillRect(n.x,n.y,n.width,n.height);var i=v.groupFillColor(t.model,e._options);t.groups&&t.groups.forEach((function(t){var n=e._cutBounds(t.size);n&&(e._ctx.fillStyle=i,e._ctx.fillRect(n.x,n.y,n.width,n.height))}))}})),this._ctx.restore())}},{key:"_cutBounds",value:function(e){if(!e)return null;var t=this._canvas.clientWidth,n=this._options.headerHeight||0,i=this._canvas.clientWidth;if(c.isRectOverlap(e,{x:0,y:n,width:c.getDistance(0,t),height:c.getDistance(n,i)})){var r=Math.max(e.y,n),o=Math.max(e.x,0),l=e.x-o,a=e.y-r;return{height:e.height+a,width:e.width+l,x:o,y:r,overlapY:Math.abs(a)>0,overlapX:Math.abs(l)>0}}return null}},{key:"_getKeyframesGroupSize",value:function(e,t,n,i){var r=v.rowGroupHeight(e,this._options),o=v.getRowHeight(e,this._options);(!r&&0!==r||isNaN(r)||"auto"==r)&&(r=Math.floor(.7*o)),r>o&&(r=o);var l=o-r,a=this.valToPx(n),s=this.valToPx(i);return{x:a,y:t+Math.floor(l/2),height:r,width:c.getDistance(a,s)}}},{key:"_getKeyframePosition",value:function(e,t){if(!e)return console.log("keyframe should be defined."),null;var n=e.val;if(isNaN(n))return null;var i=t.size,r=i.y+i.height/2,o=v.getKeyframeStyle(e,t.model,this._options,"height","auto"),l=v.getKeyframeStyle(e,t.model,this._options,"width","auto");return"auto"==o&&(o=i.height/3),"auto"==l&&(l=o),o>0&&!isNaN(n)?{x:Math.floor(this.valToPx(n)),y:Math.floor(r),height:o,width:l}:null}},{key:"_renderKeyframes",value:function(){var e=this;this._forEachKeyframe((function(t){var n=t.parentRow.model,i=t.size,r=t.model;if(i){var o=e._getSharp(i.x),l=i.y,s=e._cutBounds({x:o-i.width/2,y:l-i.height/2,width:i.width,height:i.height});if(!s)return;e._ctx.save(),s&&s.overlapY&&(e._ctx.beginPath(),e._ctx.rect(0,e._options.headerHeight||0,e._canvas.clientWidth,e._canvas.clientWidth),e._ctx.clip());var c=v.keyframeShape(r,n,e._options);if(c===a.None)return;var u=r.selected?v.keyframeFillColor(r,n,e._options):v.keyframeSelectedFillColor(r,n,e._options),h=v.keyframeStrokeThickness(r,n,e._options),f=h>0?v.keyframeStrokeColor(r,n,e._options):"";c==a.Rhomb?(e._ctx.beginPath(),e._ctx.translate(o,l),e._ctx.rotate(45*Math.PI/180),h>0&&f&&(e._ctx.fillStyle=f,e._ctx.rect(-i.width/2,-i.height/2,i.width,i.height),e._ctx.fill()),e._ctx.fillStyle=u,e._ctx.translate(h,h),e._ctx.rect(-i.width/2,-i.height/2,i.width-2*h,i.height-2*h),e._ctx.fill()):c==a.Circle?(e._ctx.beginPath(),h>0&&f&&(e._ctx.fillStyle=f,e._ctx.arc(o,l,i.height,0,2*Math.PI)),e._ctx.fillStyle=u,e._ctx.arc(o,l,i.height-h,0,2*Math.PI),e._ctx.fill()):c==a.Rect&&(e._ctx.beginPath(),l-=i.height/2,o-=i.width/2,h>0&&f&&(e._ctx.fillStyle=f,e._ctx.rect(o,l,i.width,i.height),e._ctx.fill()),e._ctx.fillStyle=u,e._ctx.rect(o+h,l+h,i.width-h,i.height-h),e._ctx.fill()),e._ctx.restore()}}))}},{key:"_renderSelectionRect",value:function(){this._drag||(this._ctx.save(),this._selectionRect&&this._selectionRectEnabled&&(this._ctx.setLineDash([4]),this._ctx.lineWidth=this._pixelRatio,this._ctx.strokeStyle=this._options.selectionColor,this._ctx.strokeRect(this._getSharp(this._selectionRect.x,1),this._getSharp(this._selectionRect.y,1),Math.floor(this._selectionRect.width),Math.floor(this._selectionRect.height))),this._ctx.restore())}},{key:"_renderBackground",value:function(){this._options.fillColor?(this._ctx.save(),this._ctx.beginPath(),this._ctx.rect(0,0,this._canvas.clientWidth,this._canvas.clientHeight),this._ctx.fillStyle=this._options.fillColor,this._ctx.fill(),this._ctx.restore()):this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)}},{key:"_renderTimeline",value:function(){if(this._options&&this._options.timelineStyle){var e=this._options.timelineStyle;this._ctx.save();var t=e.width||1;this._ctx.lineWidth=t*this._pixelRatio;var n=this._getSharp(Math.round(this.valToPx(this._val)),t);this._ctx.strokeStyle=e.strokeColor,this._ctx.fillStyle=e.fillColor;var i=e.marginTop;if(this._ctx.beginPath(),c.drawLine(this._ctx,n,i,n,this._canvas.clientHeight),this._ctx.stroke(),e.capHeight&&e.capWidth){var r=e.capWidth,o=e.capHeight;e.capType===_.Triangle?(this._ctx.beginPath(),this._ctx.moveTo(n-r/2,i),this._ctx.lineTo(n+r/2,i),this._ctx.lineTo(n,o),this._ctx.closePath(),this._ctx.stroke()):e.capType===_.Rect&&(this._ctx.fillRect(n-r/2,i,r,o),this._ctx.fill())}this._ctx.restore()}}},{key:"_renderHeaderBackground",value:function(){!isNaN(this._options.headerHeight)&&this._options.headerHeight>0&&(this._ctx.save(),this._ctx.lineWidth=this._pixelRatio,this._options.headerFillColor?(this._ctx.lineWidth=this._pixelRatio,this._ctx.fillStyle=this._options.headerFillColor,this._ctx.fillRect(0,0,this._canvas.clientWidth,this._options.headerHeight)):this._ctx.clearRect(0,0,this._canvas.clientWidth,this._options.headerHeight),this._ctx.restore())}},{key:"redraw",value:function(){window.requestAnimationFrame?window.requestAnimationFrame(this._redrawInternal):this._redrawInternal()}},{key:"scrollLeft",value:function(){this._scrollContainer.scrollLeft!=this._scrollContainer.scrollWidth&&(this._scrollContainer.scrollLeft=this._scrollContainer.scrollWidth)}},{key:"getRowByY",value:function(e){var t=this._calculateModel();if(t&&t.rows)for(var n=0;n<t.rows.length;n++){var i=t.rows[n].size;if(i&&i.y>=e&&e<=i.y+i.height)return i}return null}},{key:"_getSharp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t%2==0?e:e+this._pixelRatio/2}},{key:"getTime",value:function(){return this._val}},{key:"_setTimeInternal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.Programmatically;if((e=Math.round(e))<0&&(e=0),this._val!=e){var n=this._val,i=new ie;return i.val=e,i.prevVal=n,i.source=t,this._val=e,this.emit(f.TimeChanged,i),!i.isPrevented()||(this._val=n,!1)}return!1}},{key:"setTime",value:function(e){return(!this._drag||this._drag.type!==h.Timeline)&&this._setTimeInternal(e,H.SetTimeMethod)}},{key:"select",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._performSelection(e),this.redraw()}},{key:"getOptions",value:function(){return this._options}},{key:"setScrollLeft",value:function(e){this._scrollContainer&&(this._scrollContainer.scrollLeft=e)}},{key:"setScrollTop",value:function(e){this._scrollContainer&&(this._scrollContainer.scrollTop=e)}},{key:"getScrollLeft",value:function(){return this._scrollContainer?this._scrollContainer.scrollLeft:0}},{key:"getScrollTop",value:function(){return this._scrollContainer?this._scrollContainer.scrollTop:0}},{key:"setOptions",value:function(e){return this._options=this._mergeOptions(e),this.rescale(),this.redraw(),this._options}},{key:"getModel",value:function(){return this._model}},{key:"setModel",value:function(e){this._model=e,this.rescale(),this.redraw()}},{key:"_getMousePos",value:function(e,t){var n=1,i=0,r=0;if(t.changedTouches&&t.changedTouches.length>0){var o=t.changedTouches[0];i=o.clientX,r=o.clientY,n=Math.max(n,o.radiusX,o.radiusY)}else i=t.clientX,r=t.clientY;var l=e.getBoundingClientRect(),a=e.width/this._pixelRatio/l.width,s=e.height/this._pixelRatio/l.height;return{x:(i-l.left)*a,y:(r-l.top)*s,radius:n}}},{key:"_updateCanvasScale",value:function(){if(this._scrollContainer&&this._ctx){var e=!1,t=this._scrollContainer.clientWidth*this._pixelRatio,n=this._scrollContainer.clientHeight*this._pixelRatio;return Math.floor(t)!=Math.floor(this._ctx.canvas.width)&&(this._ctx.canvas.width=t,e=!0),Math.floor(n)!=Math.floor(this._ctx.canvas.height)&&(this._ctx.canvas.height=n,e=!0),e&&this._ctx.setTransform(this._pixelRatio,0,0,this._pixelRatio,0,0),e}console.log("control should be initialized first")}},{key:"rescale",value:function(){this._rescaleInternal()}},{key:"_rescaleInternal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default";this._updateCanvasScale();var i=this._calculateModel();if(i&&i.size){var r=this._options.stepPx;e=e||0;var o=this.valToPx(this._val,!0),l=0;o>this._canvas.clientWidth&&(l="scrollBySelection"==n?Math.floor(o+this._canvas.clientWidth+(this._options.stepPx||0)):Math.floor(o+this._canvas.clientWidth/1.5));var a=i.size.width+this._options.leftMargin+r;e=Math.max(e,a,this._scrollContainer.scrollLeft+this._canvas.clientWidth,l);var s=Math.floor(e)+"px";s!=this._scrollContent.style.minWidth&&(this._scrollContent.style.minWidth=s);var c=(t=Math.max(Math.floor(i.size.height+.2*this._canvas.clientHeight),this._scrollContainer.scrollTop+this._canvas.clientHeight-1,Math.round(t||0)))+"px";this._scrollContent.style.minHeight!=c&&(this._scrollContent.style.minHeight=c)}}},{key:"_findDraggable",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=function(e){return e===h.Timeline?1:e===h.Keyframe?2:e===h.Group?3:-1},r=e.filter((function(e){if(!e)return!1;if(e.type===h.Keyframe){if(!v.keyframeDraggable(e.keyframe,e.row,t._options))return!1}else if(e.type===h.Group){if(!v.groupDraggable(e.row,t._options))return!1}else if(e.type===h.Row)return!1;return!0})),o=r.sort((function(e,t){var r=i(e.type),o=i(t.type);return r!==o||null!==n&&(r=c.getDistance(e.val,n))!==(o=c.getDistance(t.val,n))?r<o?1:-1:0}));return o.length>0?o[o.length-1]:null}},{key:"elementFromPoint",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;n=Math.max(n,1);var i=[];if(!e)return i;var r=this.valToPx(this._val),o=0;if(this._options&&this._options.timelineStyle){var l=this._options.timelineStyle;o=Math.max((l.width||1)*this._pixelRatio,(l.capWidth||0)*this._pixelRatio||1)+n}return(e.y<=.5*this._options.headerHeight||e.x>=r-o/2&&e.x<=r+o/2)&&i.push({val:this._val,type:h.Timeline}),e.y>=this._options.headerHeight&&this._options.keyframesDraggable&&this._forEachKeyframe((function(r,o,l){if(l){if(c.isOverlap(e.x,e.y,r.parentRow.size)){var a={val:t._mousePosToVal(e.x,!0),keyframes:r.parentRow.model.keyframes,type:h.Row,row:r.parentRow.model};i.push(a)}r.parentRow.groups&&r.parentRow.groups.forEach((function(n){if(c.isOverlap(e.x,e.y,n.size)){for(var o=[],l=n.keyframes,a=0;a<l.length;a++)o.push(l[a].model);var s={val:t._mousePosToVal(e.x,!0),type:h.Group,group:n,row:r.parentRow.model,keyframes:o},u=t.snapVal(n.minValue);s.val+=n.minValue-u,i.push(s)}}))}var s=r.size;s&&c.getDistance(s.x,s.y,e.x,e.y)<=s.height+n&&i.push({keyframe:r.model,keyframes:[r.model],val:r.model.val,row:r.parentRow.model,type:h.Keyframe})})),i}},{key:"_mergeOptions",value:function(e){e=e||{};var t=JSON.parse(JSON.stringify(Z));return function e(t,n){if(t&&n)for(var i in t)Object.prototype.hasOwnProperty.call(n,i)&&void 0!==n[i]&&("object"===re(n[i])&&t[i]?e(t[i],n[i]):t[i]=n[i])}(t,e),t}},{key:"onTimeChanged",value:function(e){this.on(f.TimeChanged,e)}},{key:"onDragStarted",value:function(e){this.on(f.DragStarted,e)}},{key:"onDrag",value:function(e){this.on(f.Drag,e)}},{key:"onDragFinished",value:function(e){this.on(f.DragFinished,e)}},{key:"onDoubleClick",value:function(e){this.on(f.DoubleClick,e)}},{key:"onMouseDown",value:function(e){this.on(f.MouseDown,e)}},{key:"onSelected",value:function(e){this.on(f.Selected,e)}},{key:"onScroll",value:function(e){this.on(f.Scroll,e)}},{key:"_emitScrollEvent",value:function(e){var t={args:e,scrollLeft:this._scrollContainer.scrollLeft,scrollTop:this._scrollContainer.scrollTop,scrollHeight:this._scrollContainer.scrollHeight,scrollWidth:this._scrollContainer.scrollWidth};return he(fe(o.prototype),"emit",this).call(this,f.Scroll,t),t}},{key:"_emitDragStartedEvent",value:function(){var e=this._getDragEventArgs();return this.emit(f.DragStarted,e),e}},{key:"_emitDragFinishedEvent",value:function(){if(this._drag&&this._drag.changed){var e=this._getDragEventArgs();return this.emit(f.DragFinished,e),e}}},{key:"_emitDragEvent",value:function(){if(this._drag){var e=this._getDragEventArgs();return this.emit(f.Drag,e),e}return null}},{key:"_emitKeyframesSelected",value:function(e){var t=new C;return t.keyframes=e,this.emit(f.Selected,t),t}},{key:"_getDragEventArgs",value:function(){var e=new N;return this._drag&&(e.val=this._currentPos.val,e.pos=this._currentPos,e.elements=this._drag.elements,e.target=this._drag.target),e}}])&&le(t.prototype,n),i&&le(t,i),o}(r),ve=n(1),pe=n(2),ye=n(3),me=n(4),ge=n(5),we=n(6),xe=n(7),ke=n(8),be=n(9),Se=n(10),Te=n(11),Ce=n(0),Pe=n(12)}])}));
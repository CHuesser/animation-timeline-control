{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///./src/timelineEventsEmitter.ts","webpack:///./src/utils/timelineUtils.ts","webpack:///./src/enums/timelineCursorType.ts","webpack:///./src/enums/timelineKeyframeShape.ts","webpack:///./src/utils/timelineStyleUtils.ts","webpack:///./src/enums/timelineElementType.ts","webpack:///./src/enums/timelineEvents.ts","webpack:///./src/enums/timelineCapShape.ts","webpack:///./src/enums/timelineInteractionMode.ts","webpack:///./src/utils/events/timelineBaseEvent.ts","webpack:///./src/utils/events/timelineSelectedEvent.ts","webpack:///./src/utils/events/timelineClickEvent.ts","webpack:///./src/utils/events/timelineDragEvent.ts","webpack:///./src/settings/defaults.ts","webpack:///./src/enums/timelineEventSource.ts","webpack:///./src/utils/events/timelineTimeChangedEvent.ts","webpack:///./src/enums/timelineSelectionMode.ts","webpack:///./src/utils/events/timelineKeyframeChangedEvent.ts","webpack:///./src/timeline.ts","webpack:///./src/animation-timeline.ts","webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///webpack/startup"],"names":["TimelineEventsEmitter","topic","callback","_subscriptions","push","filter","event","length","args","forEach","denominators","TimelineUtils","ctx","x1","y1","x2","y2","moveTo","lineTo","val","isNaN","Number","isFinite","array","element","index","indexOf","splice","x","y","rectangle","width","height","originalStep","divisionCheck","step","lastDistance","pow","getPowArgument","i","denominator","calculatedStep","Math","distance","getDistance","value","min","max","isNumber","to","from","shrink","fromMin","getMin","toMin","isFromMinNumber","isToMinNumber","fromMax","getMax","toMax","isFromMaxNumber","isToMaxNumber","rect","rect2","console","log","undefined","sqrt","abs","p","window","getSelection","removeAllRanges","doc","document","selection","empty","toCheck","category","s","sign","floor","zerosCount","TimelineCursorType","TimelineKeyframeShape","TimelineStyleUtils","keyframeStyle","rowStyle","options","propertyName","defaultValue","reverseOrder","styles","style","keyframesStyle","globalRowStyle","rowsStyle","results","keyframe","shape","getKeyframeStyle","color","getRowStyle","headerHeight","TimelineElementType","TimelineEvents","TimelineCapShape","TimelineInteractionMode","TimelineBaseEvent","_prevented","TimelineSelectedEvent","TimelineClickEvent","TimelineDragEvent","defaultTimelineStyle","marginTop","capWidth","capHeight","capType","strokeColor","fillColor","defaultTimelineKeyframeStyle","selectedFillColor","selectedStrokeColor","strokeThickness","draggable","defaultTimelineRowStyle","marginBottom","groupFillColor","groupHeight","defaultTimelineOptions","snapAllKeyframesOnMove","snapEnabled","timelineStyle","stepPx","stepVal","stepSmallPx","snapStep","leftMargin","headerFillColor","labelsColor","tickColor","selectionColor","font","zoom","zoomSpeed","zoomMin","zoomMax","controlKeyIsMetaKey","scrollContainerClass","groupsDraggable","keyframesDraggable","MAX_VALUE","defaultTimelineConsts","autoPanSpeed","scrollByDragSpeed","clickDetectionMs","doubleClickTimeoutMs","scrollFinishedTimeoutMs","autoPanByScrollPadding","clickThreshold","TimelineEventSource","TimelineTimeChangedEvent","TimelineSelectionMode","TimelineKeyframeChangedEvent","Timeline","model","_interactionMode","_setZoomCursor","_cleanUpSelection","rescale","redraw","_clearScrollFinishedTimer","_scrollFinishedTimerRef","setTimeout","_isPanStarted","clearTimeout","_consts","_emitScrollEvent","_controlKeyPressed","preventDefault","mousePos","_getMousePos","_canvas","_zoom","deltaY","_options","_scrollContainer","scrollTop","isDoubleClick","Date","now","_lastClickTime","_startPos","_trackMousePos","_lastClickPoint","_scrollStartPos","scrollLeft","_clickAllowed","elements","elementFromPoint","radius","target","_findDraggable","pos","originalVal","snapVal","_clickTimeout","isPrevented","_currentPos","_drag","changed","_setElementDragState","type","_startedDragWithCtrl","_startedDragWithShiftKey","shiftKey","selected","_selectInternal","getSelectedElements","map","keyframes","Array","isArray","_convertToElement","row","_lastUsedArgs","isTouch","changedTouches","_selectionRect","_clickTimeoutIsOver","_selectionRectEnabled","isLeftClicked","isLeftButtonClicked","convertedVal","_setTimeInternal","offset","movedOffset","_moveElements","prevVal","eventArgs","_emitDragStartedEvent","_emitDragEvent","_setCursor","_scrollByPan","_scrollBySelectionOutOfBounds","cursor","direction","_performClick","_getKeyframesByRectangle","selectionMode","select","_ctx","valToPx","_val","scrollWidth","_renderBackground","_renderRows","_renderHeaderBackground","_renderTicks","_renderKeyframes","_renderSelectionRect","_renderTimeline","initialize","_model","id","Error","_generateContainers","_setOptions","_subscribeOnEvents","HTMLElement","_container","getElementById","createElement","_scrollContent","getContext","position","cssText","appendChild","scrollBarWidth","offsetWidth","clientWidth","addEventListener","_handleWheelEvent","_handleScrollEvent","_handleKeyUp","_handleKeyDown","_handleBlurEvent","_handleWindowResizeEvent","_handleMouseDownEvent","_handleMouseMoveEvent","_handleMouseUpEvent","offAll","removeEventListener","_stopAutoPan","e","metaKey","ctrlKey","speed","deltaSpeed","_width","diff","_fromScreen","_currentZoom","_setZoom","zoomCenter","newScrollLeft","round","_rescaleInternal","prevZoom","getZoom","zoomSet","state","startedVal","buttons","source","isChanged","bounds","MIN_SAFE_INTEGER","MAX_SAFE_INTEGER","currentBounds","expectedKeyframeValue","newPosition","toSet","newValue","_setKeyframePos","clientHeight","screenRect","keyframesModels","_forEachKeyframe","calcKeyframe","size","drag","mode","selectionChanged","_emitKeyframeChanged","data","_mapKeyframes","parentRow","getAllKeyframes","node","selectable","nodes","getSelectedKeyframes","nodesArray","_changeNodeState","selectedItems","exists","_emitKeyframesSelected","calculatedModel","_calculateModel","rows","calcRow","nextRow","keyframeIndex","canvas","mouseArgs","_mousePosToVal","getScrollLeft","getScrollTop","_emitDragFinishedEvent","_intervalRef","setInterval","clearInterval","_autoPanLastActionDate","start","scrollStartPos","offsetX","newLeft","speedX","speedY","isLeft","isRight","isTop","isBottom","_height","newWidth","newHeight","_startAutoPan","_checkUpdateSpeedTooFast","scrollSpeedMultiplier","px","steps","_leftMargin","pxToVal","stops","stepsFit","minSteps","minOffset","ms","isSeconds","seconds","year","days","hours","minutes","str","rulerActive","screenWidth","wasToVal","valDistance","smallStep","fromVal","toVal","ceil","lastTextStart","save","tickHeight","smallTickHeight","sharpPos","_getSharp","_toScreenPx","beginPath","setLineDash","lineWidth","strokeStyle","stroke","fillStyle","text","_formatUnitsText","textSize","measureText","textX","fillText","restore","nextSharpPos","_pixelRatio","toReturn","rowAbsoluteHeight","hidden","rowHeight","currentRowY","groups","currentGroup","existingGroup","group","keyframeSize","_getKeyframePosition","parentGroup","groupRect","_getKeyframesGroupSize","rowCalc","_cutBounds","fillRect","keyframeLaneColor","rectBounds","minX","maxX","minY","maxY","offsetW","offsetH","overlapY","overlapX","rowY","minValue","maxValue","margin","xMin","xMax","rowCalculated","rowSize","clip","keyframeColor","border","translate","rotate","PI","fill","arc","thickness","strokeRect","clearRect","timeLinePos","rectSize","closePath","requestAnimationFrame","_redrawInternal","posY","timelineEvent","emit","_mergeOptions","classList","contains","add","background","clientX","clientY","touch","radiusX","radiusY","getBoundingClientRect","scaleX","scaleY","left","top","setTransform","scrollMode","_updateCanvasScale","additionalOffset","timelineGlobalPos","timelinePos","keyframeW","minWidthPx","minWidth","h","minHeight","getPriority","filteredElements","sorted","sort","a","b","prioA","prioB","clickRadius","snap","isNextRow","rowOverlapped","keyframesGroupOverlapped","groupElement","snapped","keyframePos","dist","Keyframe","JSON","parse","stringify","mergeOptionsDeep","key","Object","prototype","hasOwnProperty","call","on","scrollEvent","scrollHeight","_getDragEventArgs","_preventDrag","dragArgs","toStart","draggableArguments"],"mappings":"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","file":"animation-timeline.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"timelineModule\"] = factory();\n\telse\n\t\troot[\"timelineModule\"] = factory();\n})(self, function() {\nreturn ","interface Event {\n  topic: string;\n  callback: Function;\n}\n\nexport class TimelineEventsEmitter {\n  protected _subscriptions: Array<Event> = [];\n\n  // on event.\n  on(topic: string, callback: Function): void {\n    if (!callback) {\n      return;\n    }\n\n    this._subscriptions.push({\n      topic: topic,\n      callback: callback,\n    });\n  }\n  /**\n   * Remove an event from the subscriptions list.\n   */\n  off(topic: string, callback: Function): void {\n    this._subscriptions = this._subscriptions.filter((event) => {\n      return event && event.callback != callback && event.topic != topic;\n    });\n  }\n\n  /**\n   * Unsubscribe all\n   */\n  offAll(): void {\n    this._subscriptions.length = 0;\n  }\n\n  // emit event.\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  emit(topic: string, args: any): void {\n    this._subscriptions.forEach((event) => {\n      if (event && event.topic == topic && event.callback) {\n        event.callback(args);\n      }\n    });\n  }\n}\n","import { TimelineRanged } from '../timelineRanged';\n\nconst denominators = [1, 2, 5, 10];\nexport class TimelineUtils {\n  static drawLine(ctx: CanvasRenderingContext2D, x1: number, y1: number, x2: number, y2: number): void {\n    ctx.moveTo(x1, y1);\n    ctx.lineTo(x2, y2);\n  }\n  /**\n   * Check is valid number.\n   */\n  static isNumber(val?: number): boolean {\n    if (typeof val === 'number' && !isNaN(val) && Number.isFinite(val)) {\n      return true;\n    }\n\n    return false;\n  }\n  static deleteElement<T>(array: Array<T>, element: T): Array<T> {\n    const index: number = array.indexOf(element);\n    if (index !== -1) {\n      return array.splice(index, 1);\n    }\n    return array;\n  }\n\n  /**\n   * Check rectangle overlap.\n   */\n  static isOverlap(x: number, y: number, rectangle: DOMRect): boolean {\n    if (!rectangle) {\n      return false;\n    }\n\n    if (rectangle.x <= x && rectangle.x + rectangle.width >= x && rectangle.y <= y && rectangle.y + rectangle.height >= y) {\n      return true;\n    }\n\n    return false;\n  }\n  /**\n   * Find beautiful step for the header line gauge.\n   */\n  static findGoodStep(originalStep: number, divisionCheck = 0): number {\n    if (originalStep <= 0 || isNaN(originalStep) || !Number.isFinite(originalStep)) {\n      return originalStep;\n    }\n    let step = originalStep;\n    let lastDistance = null;\n    const pow = TimelineUtils.getPowArgument(originalStep);\n    for (let i = 0; i < denominators.length; i++) {\n      const denominator = denominators[i];\n      const calculatedStep = denominator * Math.pow(10, pow);\n      if (divisionCheck && divisionCheck % calculatedStep != 0) {\n        continue;\n      }\n      const distance = TimelineUtils.getDistance(originalStep, calculatedStep);\n\n      if (distance == 0 || (distance <= 0.1 && pow > 0)) {\n        lastDistance = distance;\n        step = calculatedStep;\n        break;\n      } else if (!lastDistance || lastDistance > distance) {\n        lastDistance = distance;\n        step = calculatedStep;\n      }\n    }\n\n    return step;\n  }\n  /**\n   * Keep value in min, max bounds.\n   */\n  static keepInBounds(value: number, min: number | undefined = null, max: number | undefined = null): number {\n    if (TimelineUtils.isNumber(value)) {\n      if (TimelineUtils.isNumber(min)) {\n        value = Math.max(value, min);\n      }\n      if (TimelineUtils.isNumber(max)) {\n        value = Math.min(value, max);\n      }\n    }\n\n    return value;\n  }\n  static setMinMax(to: TimelineRanged, from: TimelineRanged, shrink = false): TimelineRanged {\n    if (!from || !to) {\n      return to;\n    }\n    const fromMin = Math.min(from.getMin ? from.getMin() : from.min, from.min);\n    const toMin = Math.min(to.getMin ? to.getMin() : to.min, to.min);\n    const isFromMinNumber = TimelineUtils.isNumber(fromMin);\n    const isToMinNumber = TimelineUtils.isNumber(toMin);\n    // get absolute min and max bounds:\n    if (isFromMinNumber && isToMinNumber) {\n      to.min = shrink ? Math.min(fromMin, toMin) : Math.max(fromMin, toMin);\n    } else if (isFromMinNumber) {\n      to.min = fromMin;\n    }\n\n    const fromMax = Math.min(from.getMax && from.getMax ? from.getMax() : from.max, from.max);\n    const toMax = Math.min(to.getMax ? to.getMax() : to.max, to.max);\n    const isFromMaxNumber = TimelineUtils.isNumber(fromMax);\n    const isToMaxNumber = TimelineUtils.isNumber(toMax);\n    if (isFromMaxNumber && isToMaxNumber) {\n      to.max = shrink ? Math.max(fromMax, toMax) : Math.min(fromMax, toMax);\n    } else if (isFromMaxNumber) {\n      to.max = fromMax;\n    }\n\n    return to;\n  }\n  static isRectOverlap(rect: DOMRect, rect2: DOMRect): boolean {\n    if (!rect || !rect2) {\n      console.log('Rectangles cannot be empty');\n      return false;\n    }\n\n    // If one rectangle is on left side of other\n    if (rect.x > rect2.x + rect2.width || rect2.x > rect.x + rect.width) {\n      return true;\n    }\n\n    // If one rectangle is above other\n    if (rect.y < rect2.y + rect2.height || rect2.y < rect.y + rect.height) {\n      return true;\n    }\n    return false;\n  }\n\n  static getDistance(x1: number, y1: number, x2?: number, y2?: number): number {\n    if (x2 != undefined && y2 != undefined) {\n      return Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2));\n    } else {\n      return Math.abs(x1 - y1);\n    }\n  }\n  static sign(p: number): number {\n    return p >= 0 ? 1 : -1;\n  }\n\n  static clearBrowserSelection(): void {\n    if (!window) {\n      return;\n    }\n    if (window.getSelection) {\n      window.getSelection().removeAllRanges();\n    } else {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const doc: any = window.document;\n      if (doc.selection) {\n        doc.selection.empty();\n      }\n    }\n  }\n  static getPowArgument(toCheck: number): number {\n    if (!toCheck || toCheck === 0 || !isFinite(toCheck)) {\n      return 1;\n    }\n    // some optimization for numbers:\n    if (toCheck >= 10 && toCheck < 100) {\n      return 1;\n    } else if (toCheck >= 100 && toCheck < 1000) {\n      return 2;\n    } else if (toCheck >= 1000 && toCheck < 10000) {\n      return 3;\n    }\n\n    toCheck = Math.abs(toCheck);\n    let category = 0;\n    const s = this.sign(toCheck);\n    if (toCheck > 1) {\n      while (toCheck >= 1) {\n        toCheck = Math.floor(toCheck / 10.0);\n        category++;\n      }\n\n      return s * category - 1;\n    } else if (toCheck > 0.0) {\n      // Get number of zeros before the number.\n      const zerosCount = Math.floor(Math.log(toCheck) / Math.log(10) + 1) - 1;\n      return zerosCount;\n    } else {\n      return 1;\n    }\n  }\n}\n","export enum TimelineCursorType {\n  Alias = 'alias',\n  AllScroll = 'all-scroll',\n  Auto = 'auto',\n  Cell = 'cell',\n  ContextMenu = 'context-menu',\n  ColResize = 'col-resize',\n  Copy = 'copy',\n  Crosshair = 'crosshair',\n  Default = 'default',\n  EResize = 'e-resize',\n  EWResize = 'ew-resize',\n  Grab = 'grab',\n  Grabbing = 'grabbing',\n  Help = 'help',\n  Move = 'move',\n  NResize = 'n-resize',\n  NEResize = 'ne-resize',\n  NESWResize = 'nesw-resize',\n  NSResize = 'ns-resize',\n  NWResize = 'nw-resize',\n  NWSEResize = 'nwse-resize',\n  NoDrop = 'no-drop',\n  None = 'none',\n  NotAllowed = 'not-allowed',\n  Pointer = 'pointer',\n  Progress = 'progress',\n  RowResize = 'row-resize',\n  SResize = 's-resize',\n  SEResize = 'se-resize',\n  SWResize = 'sw-resize',\n  Text = 'text',\n  WResize = 'w-resize',\n  Wait = 'wait',\n  ZoomIn = 'zoom-in',\n  ZoomOut = 'zoom-out',\n}\n","export enum TimelineKeyframeShape {\n  None = 'none',\n  Rhomb = 'rhomb',\n  Circle = 'circle',\n  Rect = 'rect',\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { TimelineRow } from '../timelineRow';\nimport { TimelineOptions } from '../settings/timelineOptions';\nimport { TimelineRowStyle } from '../settings/styles/timelineRowStyle';\nimport { TimelineKeyframeStyle } from '../settings/styles/timelineKeyframeStyle';\nimport { TimelineKeyframeShape } from '../enums/timelineKeyframeShape';\n\nexport class TimelineStyleUtils {\n  /**\n   * Get keyframe style from a keyframe, than from a row, than from a global settings.\n   * @param keyframe keyframe to get style for.\n   * @param row keyframe row.\n   * @param propertyName property to get.\n   * @param defaultValue default value to return\n   * @param reverseOrder reverse styling order: global, row, keyframe\n   */\n  static getKeyframeStyle<T>(\n    keyframeStyle: TimelineKeyframeStyle | null,\n    rowStyle: TimelineRow | null,\n    options: TimelineOptions | null,\n    propertyName: string,\n    defaultValue?: T,\n    reverseOrder = false,\n  ): T {\n    // Don't spawn new array for the normal order.\n    let styles: Array<any> | null = null;\n    if (keyframeStyle) {\n      const style: any = keyframeStyle;\n      if (style[propertyName] !== undefined) {\n        const value = style[propertyName];\n        if (!reverseOrder) {\n          return value;\n        }\n        styles = styles || [];\n        styles.push(value);\n      }\n    }\n\n    if (rowStyle && rowStyle.keyframesStyle) {\n      const style: any = rowStyle.keyframesStyle;\n      if (style[propertyName] !== undefined) {\n        const value = style[propertyName];\n        if (!reverseOrder) {\n          return value;\n        }\n        styles = styles || [];\n        styles.push(value);\n      }\n    }\n    const globalRowStyle = options ? options.rowsStyle : null;\n    if (globalRowStyle && globalRowStyle.keyframesStyle) {\n      const style: any = globalRowStyle.keyframesStyle;\n      if (style[propertyName] !== undefined) {\n        const value = style[propertyName];\n        if (!reverseOrder) {\n          return value;\n        }\n        styles = styles || [];\n        styles.push(value);\n      }\n    }\n\n    return reverseOrder && styles && styles.length > 0 ? styles[styles.length - 1] : defaultValue;\n  }\n\n  /**\n   * Get row style from default settings or overrides by a row settings.\n   */\n  static getRowStyle<T>(rowStyle: TimelineRowStyle, options: TimelineOptions | null, propertyName: string, defaultValue?: T, reverseOrder = false): T | undefined {\n    // Don't spawn new array for the normal order.\n    let styles: Array<any> = null;\n    if (rowStyle) {\n      const style: any = rowStyle;\n      if (style[propertyName] !== undefined) {\n        const results = style[propertyName] as T;\n        if (!reverseOrder) {\n          return results;\n        }\n        styles = styles || [];\n        styles.push(results);\n      }\n    }\n    const globalRowStyle = options ? options.rowsStyle : null;\n    if (globalRowStyle) {\n      const style: any = globalRowStyle;\n      if (style[propertyName] !== undefined) {\n        const results = style[propertyName] as T;\n        if (!reverseOrder) {\n          return results;\n        }\n\n        styles = styles || [];\n        styles.push(results);\n      }\n    }\n\n    return reverseOrder && styles && styles.length > 0 ? styles[styles.length - 1] : defaultValue;\n  }\n\n  static keyframeShape(keyframe: TimelineKeyframeStyle | null, rowStyle: TimelineRowStyle | null, options: TimelineOptions | null): TimelineKeyframeShape {\n    const shape = TimelineStyleUtils.getKeyframeStyle<TimelineKeyframeShape>(keyframe, rowStyle, options, 'shape', TimelineKeyframeShape.Rhomb);\n    return shape;\n  }\n  static keyframeFillColor(keyframe: TimelineKeyframeStyle | null, rowStyle: TimelineRowStyle | null, options: TimelineOptions | null): string {\n    const color = TimelineStyleUtils.getKeyframeStyle<string>(keyframe, rowStyle, options, 'fillColor', 'DarkOrange');\n    return color;\n  }\n  static keyframeSelectedFillColor(keyframe: TimelineKeyframeStyle | null, rowStyle: TimelineRowStyle | null, options: TimelineOptions | null): string {\n    const color = TimelineStyleUtils.getKeyframeStyle<string>(keyframe, rowStyle, options, 'selectedFillColor', 'red');\n    return color;\n  }\n\n  static keyframeStrokeThickness(keyframe: TimelineKeyframeStyle | null, rowStyle: TimelineRowStyle | null, options: TimelineOptions | null): number {\n    return TimelineStyleUtils.getKeyframeStyle<number>(keyframe, rowStyle, options, 'strokeThickness', 0.2, false);\n  }\n\n  static keyframeStrokeColor(keyframe: TimelineKeyframeStyle | null, rowStyle: TimelineRowStyle | null, options: TimelineOptions | null): string {\n    return TimelineStyleUtils.getKeyframeStyle<string>(keyframe, rowStyle, options, 'strokeColor', 'Black', false);\n  }\n  static keyframeSelectedStrokeColor(keyframe: TimelineKeyframeStyle | null, rowStyle: TimelineRowStyle | null, options: TimelineOptions | null): string {\n    return TimelineStyleUtils.getKeyframeStyle<string>(keyframe, rowStyle, options, 'selectedStrokeColor', 'Black', false);\n  }\n  /**\n   * Get current row height from styling\n   */\n  static getRowHeight(rowStyle: TimelineRowStyle, options: TimelineOptions): number {\n    return TimelineStyleUtils.getRowStyle<number>(rowStyle, options, 'height', 24);\n  }\n  static rowGroupHeight(rowStyle: TimelineRowStyle, options: TimelineOptions): number | string {\n    return TimelineStyleUtils.getRowStyle<number | string>(rowStyle, options, 'groupHeight', 'auto');\n  }\n  static groupFillColor(rowStyle: TimelineRowStyle, options: TimelineOptions): string | null {\n    return TimelineStyleUtils.getRowStyle<string>(rowStyle, options, 'groupFillColor');\n  }\n  static getRowMarginBottom(rowStyle: TimelineRowStyle, options: TimelineOptions): number {\n    return TimelineStyleUtils.getRowStyle<number>(rowStyle, options, 'marginBottom', 0);\n  }\n  static getRowFillColor(rowStyle: TimelineRowStyle, options: TimelineOptions): string {\n    return TimelineStyleUtils.getRowStyle<string>(rowStyle, options, 'fillColor', '#252526');\n  }\n  static headerHeight(options: TimelineOptions | null): number {\n    return options ? options.headerHeight : 0 || 30;\n  }\n  static keyframeDraggable(keyframe: TimelineKeyframeStyle | null, rowStyle: TimelineRowStyle | null, options: TimelineOptions | null, defaultValue = true): boolean {\n    return TimelineStyleUtils.getKeyframeStyle<boolean>(keyframe, rowStyle, options, 'draggable', defaultValue, false);\n  }\n\n  static groupDraggable(rowStyle: TimelineRowStyle, options: TimelineOptions, defaultValue = true): boolean {\n    return TimelineStyleUtils.getRowStyle<boolean>(rowStyle, options, 'groupDraggable', defaultValue, false);\n  }\n}\n","export enum TimelineElementType {\n  /**\n   * Timeline\n   */\n  Timeline = 'timeline',\n  /**\n   * Keyframes\n   */\n  Keyframe = 'keyframe',\n  /**\n   * Keyframes group\n   */\n  Group = 'group',\n  /**\n   * Row\n   */\n  Row = 'row',\n}\n","export enum TimelineEvents {\n  Selected = 'selected',\n  TimeChanged = 'timechanged',\n  KeyframeChanged = 'keyframeChanged',\n  DragStarted = 'dragStarted',\n  Drag = 'drag',\n  DragFinished = 'dragFinished',\n  Scroll = 'scroll',\n  DoubleClick = 'doubleClick',\n  MouseDown = 'mouseDown',\n}\n","export enum TimelineCapShape {\n  None = 'none',\n  Triangle = 'triangle',\n  Rect = 'rect',\n}\n","export enum TimelineInteractionMode {\n  /**\n   * Selection tool\n   */\n  Selection = 'selection',\n  /**\n   * Pan tool\n   */\n  Pan = 'pan',\n  /**\n   * Zoom tool.\n   */\n  Zoom = 'zoom',\n}\n","export class TimelineBaseEvent {\n  private _prevented = false;\n  /**\n   * Prevent default click logic.\n   */\n  preventDefault(): void {\n    this._prevented = true;\n  }\n\n  isPrevented(): boolean {\n    return this._prevented;\n  }\n}\n","import { TimelineKeyframe } from '../../timelineKeyframe';\nimport { TimelineBaseEvent } from './timelineBaseEvent';\n\nexport class TimelineSelectedEvent extends TimelineBaseEvent {\n  selected: Array<TimelineKeyframe> = [];\n  changed: Array<TimelineKeyframe> = [];\n}\n","import { TimelineElement } from '../timelineElement';\nimport { TimelineBaseEvent } from './timelineBaseEvent';\nimport { TimelineValues } from '../timelineValues';\n\nexport class TimelineClickEvent extends TimelineBaseEvent implements TimelineValues {\n  args: MouseEvent;\n  /**\n   * Clicked screen position.\n   */\n  pos: DOMPoint;\n\n  /**\n   * Elements list under the click\n   */\n  elements: Array<TimelineElement>;\n  /**\n   * Target element\n   */\n  target: TimelineElement;\n  /**\n   * Value to be used.\n   */\n  val: number;\n  /**\n   * Snapped value.\n   */\n  snapVal: number;\n  /**\n   * Unsnapped original value.\n   */\n  originalVal: number;\n}\n","import { TimelineValues } from '../timelineValues';\nimport { TimelineBaseEvent } from './timelineBaseEvent';\nimport { TimelineElementDragState } from '../timelineDraggableData';\n\nexport class TimelineDragEvent extends TimelineBaseEvent implements TimelineValues {\n  args: MouseEvent;\n  /**\n   * Clicked screen position.\n   */\n  pos: DOMPoint;\n\n  /**\n   * Elements to be dragged as a group.\n   */\n  elements: Array<TimelineElementDragState>;\n  /**\n   * Target element\n   */\n  target: TimelineElementDragState;\n  /**\n   * Value to be used.\n   */\n  val: number;\n\n  /**\n   * prev value.\n   */\n  prevVal: number;\n\n  /**\n   * Snapped value.\n   */\n  snapVal: number;\n  /**\n   * Unsnapped original value.\n   */\n  originalVal: number;\n}\n","import { TimelineConsts } from './timelineConsts';\nimport { TimelineCapShape } from '../enums/timelineCapShape';\nimport { TimelineStyle } from './styles/timelineStyle';\nimport { TimelineOptions } from './timelineOptions';\nimport { TimelineKeyframeShape } from '../enums/timelineKeyframeShape';\nimport { TimelineKeyframeStyle } from './styles/timelineKeyframeStyle';\nimport { TimelineRowStyle } from './styles/timelineRowStyle';\n\nexport const defaultTimelineStyle = {\n  width: 2,\n  marginTop: 15,\n  capWidth: 4,\n  capHeight: 10,\n  /**\n   * Draw timeline rectangular cap.\n   */\n  capType: TimelineCapShape.Rect,\n  strokeColor: 'DarkOrange',\n  fillColor: 'DarkOrange',\n} as TimelineStyle;\n\nexport const defaultTimelineKeyframeStyle = {\n  /**\n   * keyframe fill color.\n   */\n  fillColor: 'DarkOrange',\n  shape: TimelineKeyframeShape.Rhomb,\n  /**\n   * Selected keyframe fill color.\n   */\n  selectedFillColor: 'red',\n  strokeColor: 'black',\n  selectedStrokeColor: 'black',\n  strokeThickness: 0.2,\n  draggable: true,\n} as TimelineKeyframeStyle;\n\nexport const defaultTimelineRowStyle = {\n  /**\n   * Row height in pixels.\n   */\n  height: 24,\n  marginBottom: 2,\n  fillColor: '#252526',\n  /**\n   * Keyframes group color\n   */\n  groupFillColor: '#094771',\n  groupHeight: 'auto',\n  keyframesStyle: defaultTimelineKeyframeStyle,\n} as TimelineRowStyle;\n\nexport const defaultTimelineOptions = {\n  /**\n   *  Snap all selected keyframes as a bundle during the drag.\n   */\n  snapAllKeyframesOnMove: false,\n\n  /**\n   * Check whether snapping is enabled.\n   */\n  snapEnabled: true,\n\n  timelineStyle: defaultTimelineStyle,\n  /**\n   * approximate step for the timeline in pixels for 1 second\n   */\n  stepPx: 120,\n  /**\n   * Number of units that should fit into one stepPx. (1 second by a default)\n   */\n  stepVal: 1000,\n  stepSmallPx: 30,\n  /**\n   * Snap step in units. from 0 to stepVal\n   */\n  snapStep: 200,\n  /**\n   * additional left margin in pixels to start the line gauge from.\n   */\n  leftMargin: 25,\n  headerFillColor: '#101011',\n  fillColor: '#101011',\n\n  labelsColor: '#D5D5D5',\n  /**\n   * Header gauge tick color.\n   */\n  tickColor: '#D5D5D5',\n  /**\n   * Selection rectangle color.\n   */\n  selectionColor: 'White',\n\n  /**\n   * Default rows style.\n   * Can be overridden by setting style individually for each row.\n   */\n  rowsStyle: defaultTimelineRowStyle,\n  /**\n   * Header height in pixels\n   */\n  headerHeight: 30,\n  font: '11px sans-serif',\n  /**\n   * Default zoom level = 1. where screen pixels are equals to the corresponding stepVal stepPx.\n   */\n  zoom: 1,\n  /**\n   * Default zoom speed.\n   */\n  zoomSpeed: 0.1,\n  /**\n   * Max zoom value.\n   */\n  zoomMin: 0.1,\n  /**\n   * Min zoom value.\n   */\n  zoomMax: 8,\n  /**\n   * Set this to true in a MAC OS environment: The Meta key will be used instead of the Ctrl key.\n   */\n  controlKeyIsMetaKey: false,\n  /**\n   * Access the scroll container via this class for e.g. scroll bar styling.\n   */\n  scrollContainerClass: 'scroll-container',\n  /**\n   * keyframes group is draggable.\n   */\n  groupsDraggable: true,\n  /**\n   * keyframes group is draggable.\n   */\n  keyframesDraggable: true,\n  min: 0,\n  max: Number.MAX_VALUE,\n} as TimelineOptions;\n\nexport const defaultTimelineConsts: TimelineConsts = {\n  /**\n   * Auto pan speed.\n   */\n  autoPanSpeed: 50,\n  /**\n   * scroll speed when mouse drag is used (from 0 to 1)\n   */\n  scrollByDragSpeed: 0.12,\n  /**\n   * Determine whether item was clicked.\n   */\n  clickDetectionMs: 120,\n  /**\n   * Timeout to detect double click.\n   */\n  doubleClickTimeoutMs: 400,\n  /**\n   * Time in ms used to refresh scrollbars when pan is finished.\n   */\n  scrollFinishedTimeoutMs: 500,\n  /**\n   * Auto pan padding\n   */\n  autoPanByScrollPadding: 10,\n  /**\n   * Click threshold\n   */\n  clickThreshold: 3,\n} as TimelineConsts;\n","export enum TimelineEventSource {\n  User = 'user',\n  Programmatically = 'programmatically',\n  SetTimeMethod = 'setTimeMethod',\n}\n","import { TimelineBaseEvent } from './timelineBaseEvent';\nimport { TimelineEventSource } from '../../enums/timelineEventSource';\n\nexport class TimelineTimeChangedEvent extends TimelineBaseEvent {\n  /**\n   * new value to be set.\n   */\n  val = 0;\n  /**\n   * previous value.\n   */\n  prevVal = 0;\n  source: TimelineEventSource = TimelineEventSource.User;\n}\n","/**\n * Timeline selection mode.\n */\nexport enum TimelineSelectionMode {\n  /**\n   * Select new items. deselect changed.\n   */\n  Normal = 'normal',\n  /**\n   * Append current selection.\n   */\n  Append = 'append',\n  /**\n   * Revert selection of a specified nodes.\n   */\n  Revert = 'revert',\n}\n","import { TimelineBaseEvent } from './timelineBaseEvent';\nimport { TimelineElement } from '../timelineElement';\nimport { TimelineEventSource } from '../../animation-timeline';\n\nexport class TimelineKeyframeChangedEvent extends TimelineBaseEvent {\n  /**\n   * Value to be used.\n   */\n  val: number;\n  /**\n   * Previous value.\n   */\n  prevVal: number;\n  /**\n   * Target element\n   */\n  target: TimelineElement;\n  /**\n   * Event source.\n   */\n  source: TimelineEventSource;\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { TimelineEventsEmitter } from './timelineEventsEmitter';\nimport { TimelineUtils } from './utils/timelineUtils';\nimport { TimelineOptions } from './settings/timelineOptions';\nimport { TimelineConsts } from './settings/timelineConsts';\nimport { TimelineKeyframe } from './timelineKeyframe';\nimport { TimelineModel } from './timelineModel';\nimport { TimelineElement } from './utils/timelineElement';\nimport { TimelineRow } from './timelineRow';\nimport { TimelineCursorType } from './enums/timelineCursorType';\nimport { TimelineKeyframeShape } from './enums/timelineKeyframeShape';\nimport { TimelineStyleUtils } from './utils/timelineStyleUtils';\nimport { TimelineElementType } from './enums/timelineElementType';\nimport { TimelineEvents } from './enums/timelineEvents';\nimport { TimelineCutBoundsRectResults } from './utils/timelineCutBoundsRectResults';\nimport { TimelineCapShape } from './enums/timelineCapShape';\nimport { TimelineCalculatedRow, TimelineModelCalcResults, TimelineCalculatedGroup, TimelineCalculatedKeyframe } from './utils/timelineModelCalcResults';\nimport { TimelineInteractionMode } from './enums/timelineInteractionMode';\nimport { TimelineScrollEvent } from './utils/events/timelineScrollEvent';\nimport { TimelineSelectedEvent } from './utils/events/timelineSelectedEvent';\nimport { TimelineDraggableData, TimelineElementDragState } from './utils/timelineDraggableData';\nimport { TimelineClickEvent } from './utils/events/timelineClickEvent';\nimport { TimelineDragEvent } from './utils/events/timelineDragEvent';\nimport { defaultTimelineConsts, defaultTimelineOptions } from './settings/defaults';\nimport { TimelineEventSource } from './enums/timelineEventSource';\nimport { TimelineTimeChangedEvent } from './utils/events/timelineTimeChangedEvent';\nimport { TimelineSelectionMode } from './enums/timelineSelectionMode';\nimport { TimelineSelectionResults } from './utils/timelineSelectionResults';\nimport { TimelineRanged } from './timelineRanged';\nimport { TimelineMouseData } from './utils/timelineMouseData';\nimport { TimelineKeyframeChangedEvent } from './utils/events/timelineKeyframeChangedEvent';\n\nexport class Timeline extends TimelineEventsEmitter {\n  /**\n   * component container.\n   */\n  _container: HTMLElement | null = null;\n  /**\n   * Dynamically generated event.\n   */\n  _canvas: HTMLCanvasElement | null = null;\n  /**\n   * Dynamically generated scroll container.\n   */\n  _scrollContainer: HTMLElement | null = null;\n  /**\n   * Dynamically generated virtual scroll content.\n   */\n  _scrollContent: HTMLElement | null = null;\n  /**\n   * Rendering context\n   */\n  _ctx: CanvasRenderingContext2D | null = null;\n  /**\n   * Components settings\n   */\n  _options: TimelineOptions | null = null;\n  /**\n   * Drag start position.\n   */\n  _startPos: TimelineMouseData | null = null;\n  /**\n   * Drag scroll started position.\n   */\n  _scrollStartPos: DOMPoint | null = { x: 0, y: 0 } as DOMPoint;\n  _currentPos: TimelineMouseData | null = null;\n\n  _selectionRect: DOMRect | null = null;\n  _selectionRectEnabled = false;\n  _drag: TimelineDraggableData | null = null;\n  _startedDragWithCtrl = false;\n  _startedDragWithShiftKey = false;\n\n  _clickTimeout? = 0;\n  _lastClickTime = 0;\n  _lastClickPoint: DOMPoint | null = null;\n  _consts: TimelineConsts = defaultTimelineConsts;\n  _clickAllowed = false;\n  /**\n   * scroll finished timer reference.\n   */\n  _scrollFinishedTimerRef?: number | null = null;\n  _val = 0;\n  _pixelRatio = 1;\n  _currentZoom = 0;\n  _intervalRef?: number | null = null;\n  _autoPanLastActionDate = 0;\n  _isPanStarted = false;\n  _interactionMode = TimelineInteractionMode.Selection;\n  _lastUsedArgs: MouseEvent | TouchEvent | null = null;\n  _model: TimelineModel | null = null;\n  /**\n   * Create Timeline instance\n   * @param options Timeline settings.\n   * @param model Timeline model.\n   */\n  constructor(options: TimelineOptions | null = null, model: TimelineModel | null = null) {\n    super();\n    // Allow to create instance without an error to perform tests.\n    if (options || model) {\n      this.initialize(options, model);\n    }\n  }\n\n  /**\n   * Initialize Timeline\n   * @param options Timeline settings.\n   * @param model Timeline model.\n   */\n  public initialize(options: TimelineOptions | null, model: TimelineModel | null): void {\n    this._model = model;\n    if (!options || !options.id) {\n      throw new Error(`Element cannot be empty. Should be string or DOM element.`);\n    }\n\n    this._generateContainers(options.id);\n    this._options = this._setOptions(options);\n    this._subscribeOnEvents();\n    this.rescale();\n    this.redraw();\n  }\n\n  /**\n   * Generate component html.\n   * @param id container.\n   */\n  _generateContainers(id: string | HTMLElement): void {\n    if (id instanceof HTMLElement) {\n      this._container = id as HTMLElement;\n    } else {\n      this._container = document.getElementById(id);\n    }\n\n    if (!this._container) {\n      throw new Error(`Element cannot be empty. Should be string or DOM element.`);\n    }\n\n    this._scrollContainer = document.createElement('div');\n    this._scrollContent = document.createElement('div');\n    this._canvas = document.createElement('canvas');\n\n    if (!this._canvas || !this._canvas.getContext) {\n      console.log('Cannot initialize canvas context.');\n      return null;\n    }\n\n    this._container.style.position = 'relative';\n    // Generate size container:\n    this._canvas.style.cssText =\n      'image-rendering: -moz-crisp-edges;' +\n      'image-rendering: -webkit-crisp-edges;' +\n      'image-rendering: pixelated;' +\n      'image-rendering: crisp-edges;' +\n      'user-select: none;' +\n      '-webkit-user-select: none;' +\n      '-khtml-user-select: none;' +\n      '-moz-user-select: none;' +\n      '-o-user-select: none;' +\n      'user-select: none;' +\n      'touch-action: none;' +\n      'position: relative;' +\n      '-webkit-user-drag: none;' +\n      '-khtml-user-drag: none;' +\n      '-moz-user-drag: none;' +\n      '-o-user-drag: none;' +\n      'user-drag: none;' +\n      'padding: inherit';\n\n    this._scrollContainer.style.cssText = 'overflow: scroll;' + 'position: absolute;' + 'width:  100%;' + 'height:  100%;';\n\n    this._scrollContent.style.width = this._scrollContent.style.height = '100%';\n\n    // add the text node to the created div\n    this._scrollContainer.appendChild(this._scrollContent);\n    this._container.appendChild(this._scrollContainer);\n    const scrollBarWidth = this._scrollContainer.offsetWidth - this._scrollContent.clientWidth;\n    // Calculate current browser scrollbar size and add offset for the canvas\n    this._canvas.style.width = this._canvas.style.height = 'calc(100% -' + (scrollBarWidth || 17) + 'px)';\n\n    this._container.appendChild(this._canvas);\n    this._ctx = this._canvas.getContext('2d');\n  }\n  /**\n   * Subscribe current component on the related events.\n   */\n  _subscribeOnEvents(): void {\n    this._container.addEventListener('wheel', this._handleWheelEvent);\n\n    if (this._scrollContainer) {\n      this._scrollContainer.addEventListener('scroll', this._handleScrollEvent);\n    }\n    document.addEventListener('keyup', this._handleKeyUp, false);\n    document.addEventListener('keydown', this._handleKeyDown, false);\n    window.addEventListener('blur', this._handleBlurEvent, false);\n    window.addEventListener('resize', this._handleWindowResizeEvent, false);\n\n    this._canvas.addEventListener('touchstart', this._handleMouseDownEvent, false);\n    this._canvas.addEventListener('mousedown', this._handleMouseDownEvent, false);\n    window.addEventListener('mousemove', this._handleMouseMoveEvent, false);\n    window.addEventListener('touchmove', this._handleMouseMoveEvent, false);\n    window.addEventListener('mouseup', this._handleMouseUpEvent, false);\n    window.addEventListener('touchend', this._handleMouseUpEvent, false);\n  }\n\n  public dispose(): void {\n    // Unsubscribe all events\n    this.offAll();\n    this._container = null;\n    this._canvas = null;\n    this._scrollContainer = null;\n    this._scrollContent = null;\n    this._ctx = null;\n    this._cleanUpSelection();\n\n    this._container.removeEventListener('wheel', this._handleWheelEvent);\n\n    if (this._scrollContainer) {\n      this._scrollContainer.removeEventListener('scroll', this._handleScrollEvent);\n    }\n\n    window.removeEventListener('blur', this._handleBlurEvent);\n    window.removeEventListener('resize', this._handleWindowResizeEvent);\n    document.removeEventListener('keydown', this._handleKeyDown);\n    document.removeEventListener('keyup', this._handleKeyUp);\n    this._canvas.removeEventListener('touchstart', this._handleMouseDownEvent);\n    this._canvas.removeEventListener('mousedown', this._handleMouseDownEvent);\n    window.removeEventListener('mousemove', this._handleMouseMoveEvent);\n    window.removeEventListener('touchmove', this._handleMouseMoveEvent);\n    window.removeEventListener('mouseup', this._handleMouseUpEvent);\n    window.removeEventListener('touchend', this._handleMouseUpEvent);\n    // Stop times\n    this._stopAutoPan();\n    this._clearScrollFinishedTimer();\n  }\n  _handleKeyUp = (event: KeyboardEvent): void => {\n    if (this._interactionMode === TimelineInteractionMode.Zoom) {\n      this._setZoomCursor(event);\n    }\n  };\n  _handleKeyDown = (event: KeyboardEvent): void => {\n    if (this._interactionMode === TimelineInteractionMode.Zoom) {\n      this._setZoomCursor(event);\n    }\n  };\n  _setZoomCursor(e: MouseEvent | KeyboardEvent): void {\n    if (this._controlKeyPressed(e)) {\n      this._setCursor(TimelineCursorType.ZoomOut);\n    } else {\n      this._setCursor(TimelineCursorType.ZoomIn);\n    }\n  }\n  _handleBlurEvent = (): void => {\n    this._cleanUpSelection();\n  };\n  _handleWindowResizeEvent = (): void => {\n    // Rescale and redraw\n    this.rescale();\n    this.redraw();\n  };\n\n  _clearScrollFinishedTimer(): void {\n    if (this._scrollFinishedTimerRef) {\n      clearTimeout(this._scrollFinishedTimerRef);\n      this._scrollFinishedTimerRef = null;\n    }\n  }\n  _handleScrollEvent = (args: MouseEvent): void => {\n    this._clearScrollFinishedTimer();\n    // Set a timeout to run event 'scrolling end'.\n    this._scrollFinishedTimerRef = window.setTimeout(() => {\n      if (!this._isPanStarted) {\n        if (this._scrollFinishedTimerRef) {\n          clearTimeout(this._scrollFinishedTimerRef);\n          this._scrollFinishedTimerRef = null;\n        }\n\n        this.rescale();\n        this.redraw();\n      }\n    }, this._consts.scrollFinishedTimeoutMs);\n\n    this.redraw();\n    this._emitScrollEvent(args);\n  };\n  _controlKeyPressed(e: MouseEvent | KeyboardEvent | TouchEvent): boolean {\n    if (!this._options || this._options.controlKeyIsMetaKey === undefined) {\n      return e.metaKey || e.ctrlKey;\n    }\n    return this._options.controlKeyIsMetaKey || this._options.controlKeyIsMetaKey ? e.metaKey : e.ctrlKey;\n  }\n  _handleWheelEvent = (event: WheelEvent): void => {\n    if (this._controlKeyPressed(event)) {\n      event.preventDefault();\n      const mousePos = Math.max(0, this._getMousePos(this._canvas, event).x || 0);\n      this._zoom(TimelineUtils.sign(event.deltaY), this._options.zoomSpeed, mousePos);\n    } else {\n      this._scrollContainer.scrollTop += event.deltaY;\n      event.preventDefault();\n    }\n  };\n  _zoom(direction: number, speed: number, x: number): void {\n    if (speed > 0 && speed <= 1) {\n      const deltaSpeed = TimelineUtils.getDistance(this._width() / 2, x) * 0.2;\n      x = x + deltaSpeed;\n      const diff = this._width() / x;\n      const val = this._fromScreen(x);\n      const zoom = direction * this._currentZoom * speed;\n      //this._options.zoom\n      this._currentZoom = this._setZoom(this._currentZoom + zoom);\n      // Get only after zoom is set\n      const zoomCenter = this.valToPx(val);\n      let newScrollLeft = Math.round(zoomCenter - this._width() / diff);\n      if (newScrollLeft <= 0) {\n        newScrollLeft = 0;\n      }\n\n      this._rescaleInternal(newScrollLeft + this._width(), null, 'zoom');\n      if (this._scrollContainer.scrollLeft != newScrollLeft) {\n        // Scroll event will redraw the screen.\n        this._scrollContainer.scrollLeft = newScrollLeft;\n      }\n\n      this.redraw();\n    }\n  }\n  /**\n   * Zoom in\n   * @param speed value from 0 to 1\n   */\n  public zoomIn(speed = this._options.zoomSpeed): void {\n    this._zoom(1, speed, this._scrollContainer.clientWidth / 2);\n  }\n  /**\n   * Zoom out.\n   * @param speed value from 0 to 1\n   */\n  public zoomOut(speed = this._options.zoomSpeed): void {\n    this._zoom(-1, speed, this._scrollContainer.clientWidth / 2);\n  }\n  /**\n   * Set direct zoom value.\n   * @param zoom zoom value to set. percent 0-1 and etc.\n   * @param min min zoom.\n   * @param max max zoom.\n   * @return normalized value.\n   */\n  _setZoom(zoom: number, min: number | undefined = null, max: number | undefined = null): number {\n    min = TimelineUtils.isNumber(min) ? min : this._options ? this._options.zoomMin : null;\n    max = TimelineUtils.isNumber(max) ? max : this._options ? this._options.zoomMax : null;\n    if (TimelineUtils.isNumber(zoom)) {\n      zoom = TimelineUtils.keepInBounds(zoom, min, max);\n      zoom = zoom || 1;\n      this._currentZoom = zoom;\n      return zoom;\n    }\n\n    return zoom;\n  }\n\n  /**\n   * Set direct zoom value.\n   * @public\n   * @param zoom zoom value to set. percent 0-1 and etc.\n   * @return normalized value.\n   */\n  setZoom(zoom: number): number {\n    const prevZoom = this.getZoom();\n    if (prevZoom !== zoom) {\n      const zoomSet = this._setZoom(zoom);\n      if (prevZoom != zoomSet) {\n        this.rescale();\n        this.redraw();\n        return zoomSet;\n      }\n    }\n    return prevZoom;\n  }\n  /**\n   * Get current zoom level.\n   */\n  getZoom(): number {\n    if (TimelineUtils.isNumber(this._currentZoom)) {\n      return this._currentZoom || 1;\n    }\n    return 1;\n  }\n  /**\n   * @param args\n   */\n  _handleMouseDownEvent = (args: MouseEvent): void => {\n    let isDoubleClick = Date.now() - this._lastClickTime < this._consts.doubleClickTimeoutMs;\n    // Prevent drag of the canvas if canvas is selected as text:\n    TimelineUtils.clearBrowserSelection();\n\n    this._startPos = this._trackMousePos(this._canvas, args);\n\n    if (!this._startPos) {\n      return;\n    }\n\n    // Don't allow to perform double click if mouse was moved to far.\n    if (this._lastClickPoint && this._startPos && TimelineUtils.getDistance(this._lastClickPoint.x, this._lastClickPoint.y, this._startPos.x, this._startPos.y) > this._consts.clickThreshold) {\n      isDoubleClick = false;\n    }\n\n    this._lastClickPoint = this._startPos;\n    this._scrollStartPos = {\n      x: this._scrollContainer.scrollLeft,\n      y: this._scrollContainer.scrollTop,\n    } as DOMPoint;\n    this._clickAllowed = true;\n    const elements = this.elementFromPoint(this._startPos, Math.max(2, this._startPos.radius));\n    const target = this._findDraggable(elements, this._startPos.val);\n    const event = new TimelineClickEvent();\n    event.pos = this._startPos;\n    event.val = this._startPos.val;\n    event.originalVal = this._startPos.originalVal;\n    event.snapVal = this._startPos.snapVal;\n    event.args = args;\n    // all elements under the click:\n    event.elements = elements;\n    // target element.\n    event.target = target;\n\n    if (isDoubleClick) {\n      super.emit(TimelineEvents.DoubleClick, event);\n      return;\n    }\n\n    super.emit(TimelineEvents.MouseDown, event);\n\n    this._clickTimeout = Date.now();\n    this._lastClickTime = Date.now();\n    if (event.isPrevented()) {\n      // Mouse up will be also prevented\n      this._cleanUpSelection();\n      return;\n    }\n\n    this._currentPos = this._startPos;\n\n    // Select keyframes on mouse down\n    if (target && this._interactionMode !== TimelineInteractionMode.Zoom) {\n      this._drag = {\n        changed: false,\n        target: this._setElementDragState(target, target.val),\n        val: target.val,\n        type: target.type,\n        elements: [],\n      } as TimelineDraggableData;\n\n      if (target.type === TimelineElementType.Keyframe) {\n        this._startedDragWithCtrl = this._controlKeyPressed(args);\n        this._startedDragWithShiftKey = args.shiftKey;\n        // get all related selected keyframes if we are selecting one.\n        if (!target.keyframe.selected && !this._controlKeyPressed(args)) {\n          this._selectInternal(target.keyframe);\n        }\n        // Allow to drag all selected keyframes on a screen\n        this._drag.elements = this.getSelectedElements().map((element) => {\n          return this._setElementDragState(element, element.val);\n        });\n      } else if (target.type === TimelineElementType.Group) {\n        const keyframes = this._drag.target.keyframes;\n\n        if (keyframes && Array.isArray(keyframes)) {\n          this._drag.elements = keyframes.map((keyframe) => {\n            return this._setElementDragState(this._convertToElement(this._drag.target.row, keyframe), keyframe.val);\n          });\n        }\n      } else {\n        this._drag.elements = [this._drag.target];\n      }\n    }\n\n    this.redraw();\n  };\n  _setElementDragState(element: TimelineElement | TimelineElementDragState, val: number): TimelineElementDragState {\n    const state = element as TimelineElementDragState;\n    state.prevVal = state.val;\n    if (state.startedVal === undefined || state.startedVal === null) {\n      state.startedVal = val;\n    }\n    if (state.prevVal === undefined || state.prevVal === null) {\n      state.prevVal = val;\n    }\n    state.val = val;\n    return state;\n  }\n  isLeftButtonClicked(args: MouseEvent | TouchEvent | any): boolean {\n    return !!args && args.buttons == 1;\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  _handleMouseMoveEvent = (args: MouseEvent | TouchEvent | any): void => {\n    if (!args) {\n      args = this._lastUsedArgs;\n    } else {\n      this._lastUsedArgs = args;\n    }\n    if (!args) {\n      return;\n    }\n    const isTouch = args.changedTouches && args.changedTouches.length > 0;\n    this._currentPos = this._trackMousePos(this._canvas, args);\n    if (!this._isPanStarted && this._selectionRect && this._clickTimeoutIsOver()) {\n      // TODO: implement selection by rect\n      this._selectionRectEnabled = this._interactionMode !== TimelineInteractionMode.Zoom;\n    } else {\n      this._selectionRectEnabled = false;\n    }\n\n    args = args as MouseEvent;\n    const isLeftClicked = this.isLeftButtonClicked(args);\n    if (this._startPos) {\n      if (isLeftClicked || isTouch) {\n        if (this._drag && !this._startedDragWithCtrl) {\n          const convertedVal = this._currentPos.val;\n          if (this._drag.type === TimelineElementType.Timeline) {\n            this._setTimeInternal(convertedVal, TimelineEventSource.User);\n          } else if ((this._drag.type == TimelineElementType.Keyframe || this._drag.type == TimelineElementType.Group) && this._drag.elements) {\n            const offset = Math.floor(convertedVal - this._drag.val);\n            const movedOffset = this._moveElements(offset, this._drag.elements, TimelineEventSource.User);\n            if (movedOffset !== 0) {\n              if (!this._drag.changed) {\n                this._drag.prevVal = this._drag.val;\n                const eventArgs = this._emitDragStartedEvent();\n                if (eventArgs.isPrevented()) {\n                  // Cleanup drag here, so drag finished will be ignored.\n                  this._drag = null;\n                  this._cleanUpSelection();\n                  return;\n                }\n              }\n\n              this._drag.changed = true;\n              this._drag.val += offset;\n              this._emitDragEvent();\n            }\n          }\n        }\n\n        if (this._interactionMode === TimelineInteractionMode.Pan && !this._drag) {\n          this._isPanStarted = true;\n          this._setCursor(TimelineCursorType.Grabbing);\n          // Track scroll by drag.\n          this._scrollByPan(this._startPos, this._currentPos, this._scrollStartPos);\n        } else {\n          // Track scroll by mouse or touch out of the area.\n          this._scrollBySelectionOutOfBounds(this._currentPos);\n        }\n\n        this.redraw();\n      } else {\n        // Fallback. Cancel mouse move when focus was lost and mouse down is still counted.\n        this._cleanUpSelection();\n        this.redraw();\n      }\n    } else if (!isTouch) {\n      const elements = this.elementFromPoint(this._currentPos, Math.max(2, this._currentPos.radius));\n      const target = this._findDraggable(elements, this._currentPos.val);\n      if (this._isPanStarted || this._interactionMode === TimelineInteractionMode.Pan) {\n        if (isLeftClicked) {\n          this._setCursor(TimelineCursorType.Grabbing);\n        } else {\n          this._setCursor(TimelineCursorType.Grab);\n        }\n      } else {\n        if (this._interactionMode === TimelineInteractionMode.Zoom) {\n          this._setZoomCursor(args);\n          return;\n        } else {\n          this._setCursor(TimelineCursorType.Default);\n        }\n      }\n\n      if (target) {\n        let cursor: TimelineCursorType | null = null;\n        if (target.type === TimelineElementType.Group) {\n          cursor = cursor || TimelineCursorType.EWResize;\n        } else if (target.type == TimelineElementType.Keyframe) {\n          cursor = cursor || TimelineCursorType.Pointer;\n        } else if (target.type == TimelineElementType.Timeline) {\n          cursor = cursor || TimelineCursorType.EWResize;\n        }\n\n        if (cursor) {\n          this._setCursor(cursor);\n        }\n      }\n    }\n\n    if (isTouch) {\n      args.preventDefault();\n    }\n  };\n\n  /**\n   * Move elements\n   * @param offset vector to move elements along.\n   * @param elements Element to move.\n   * @returns real moved value.\n   */\n  _moveElements(offset: number, elements: Array<TimelineElementDragState>, source: TimelineEventSource = TimelineEventSource.Programmatically): number {\n    if (!elements) {\n      return;\n    }\n    let isChanged = false;\n    if (Math.abs(offset) > 0) {\n      // Find drag min and max bounds:\n      let bounds = { min: Number.MIN_SAFE_INTEGER, max: Number.MAX_SAFE_INTEGER } as TimelineRanged;\n      bounds = TimelineUtils.setMinMax(bounds, this._options);\n      elements.forEach((p) => {\n        // find allowed bounds for the draggable items.\n        // find for each row and keyframe separately.\n        const currentBounds = TimelineUtils.setMinMax(TimelineUtils.setMinMax({ min: bounds.min, max: bounds.max }, p.keyframe), p.row);\n        const expectedKeyframeValue = this._options && this._options.snapAllKeyframesOnMove ? this.snapVal(p.keyframe.val) : p.keyframe.val;\n        const newPosition = expectedKeyframeValue + offset;\n        if (TimelineUtils.isNumber(currentBounds.min) && newPosition < currentBounds.min) {\n          // Return to the bounds:\n          offset = offset + TimelineUtils.getDistance(currentBounds.min, newPosition);\n        }\n        if (TimelineUtils.isNumber(currentBounds.max) && newPosition > currentBounds.max) {\n          // Return to the bounds:\n          offset = offset - TimelineUtils.getDistance(currentBounds.max, newPosition);\n        }\n      });\n\n      if (Math.abs(offset) > 0) {\n        // don't allow to move less than zero.\n        elements.forEach((element) => {\n          const prevVal = element.keyframe.val;\n          const toSet = prevVal + offset;\n          const newValue = this._setKeyframePos(element, toSet, source);\n          isChanged = newValue !== prevVal;\n        });\n      }\n\n      if (isChanged) {\n        return offset;\n      }\n    }\n\n    return 0;\n  }\n  _handleMouseUpEvent = (args: MouseEvent): void => {\n    if (this._startPos) {\n      //window.releaseCapture();\n      const pos = this._trackMousePos(this._canvas, args);\n\n      // Click detection.\n      if (this._clickAllowed || !this._clickTimeoutIsOver() || (this._drag && (this._startedDragWithCtrl || this._startedDragWithShiftKey))) {\n        if (this._options && this._interactionMode === TimelineInteractionMode.Zoom) {\n          const direction = this._controlKeyPressed(args) ? 1 : -1;\n          const mousePos = Math.max(0, this._getMousePos(this._canvas, args).x || 0);\n          this._zoom(direction, this._options.zoomSpeed, mousePos);\n        } else {\n          this._performClick(pos, this._drag);\n        }\n      } else if (!this._drag && this._selectionRect && this._selectionRectEnabled) {\n        if (this._interactionMode === TimelineInteractionMode.Zoom) {\n          if (this._selectionRect.width > 20) {\n            // TODO: implement zoom by screen rect.\n          }\n        } else {\n          const keyframes = this._getKeyframesByRectangle(this._selectionRect);\n          const selectionMode = args.shiftKey ? TimelineSelectionMode.Append : TimelineSelectionMode.Normal;\n          this.select(keyframes, selectionMode);\n        }\n      }\n\n      this._cleanUpSelection();\n      this.redraw();\n    }\n  };\n\n  /**\n   * client height.\n   */\n  _height(): number {\n    if (this._canvas) {\n      return this._canvas.clientHeight;\n    }\n    return 0;\n  }\n\n  /**\n   * Client width;\n   */\n  _width(): number {\n    if (this._canvas) {\n      return this._canvas.clientWidth;\n    }\n    return 0;\n  }\n  /**\n   * Convert virtual calculation results to keyframes\n   */\n  _mapKeyframes(array: Array<TimelineCalculatedKeyframe | TimelineElement>): Array<TimelineKeyframe> {\n    const results: Array<TimelineKeyframe> = [];\n    if (!array) {\n      return results;\n    }\n\n    for (let i = 0; i < array.length; i++) {\n      results.push((array[i] as TimelineCalculatedKeyframe).model || (array[i] as TimelineElement).keyframe);\n    }\n    return results;\n  }\n  /**\n   * Get all keyframes under the screen rectangle.\n   * @param screenRect screen coordinates to get keyframes.\n   */\n  _getKeyframesByRectangle(screenRect: DOMRect): TimelineKeyframe[] {\n    const keyframesModels: Array<TimelineKeyframe> = [];\n    this._forEachKeyframe((calcKeyframe) => {\n      if (TimelineUtils.isOverlap(calcKeyframe.size.x, calcKeyframe.size.y, screenRect)) {\n        keyframesModels.push(calcKeyframe.model);\n      }\n    });\n    return keyframesModels;\n  }\n\n  _performClick(pos: TimelineMouseData, drag: TimelineDraggableData): boolean {\n    let isChanged = false;\n    if (drag && drag.type === TimelineElementType.Keyframe) {\n      let mode = TimelineSelectionMode.Normal;\n      if ((this._startedDragWithCtrl && this._controlKeyPressed(pos.args)) || (this._startedDragWithShiftKey && pos.args.shiftKey)) {\n        if (this._controlKeyPressed(pos.args)) {\n          mode = TimelineSelectionMode.Revert;\n        }\n      }\n      // Reverse selected keyframe selection by a click:\n      isChanged = this._selectInternal(this._drag.target.keyframe, mode).selectionChanged || isChanged;\n\n      if (pos.args.shiftKey) {\n        // Set current timeline position if it's not a drag or selection rect small or fast click.\n        isChanged = this._setTimeInternal(pos.val, TimelineEventSource.User) || isChanged;\n      }\n    } else {\n      // deselect keyframes if any:\n      isChanged = this._selectInternal(null).selectionChanged || isChanged;\n\n      // change timeline pos:\n      // Set current timeline position if it's not a drag or selection rect small or fast click.\n      isChanged = this._setTimeInternal(pos.val, TimelineEventSource.User) || isChanged;\n    }\n\n    return isChanged;\n  }\n  /**\n   * Set keyframe value.\n   * @param keyframe\n   * @param value\n   * @return set value.\n   */\n  _setKeyframePos(element: TimelineElementDragState, value: number, source: TimelineEventSource = TimelineEventSource.Programmatically): number {\n    if (!element || !element.keyframe) {\n      return value;\n    }\n    value = Math.floor(value);\n    if (element.keyframe && element.keyframe.val != value) {\n      element.prevVal = element.val;\n      element.val = value;\n      element.keyframe.val = value;\n      const event = this._emitKeyframeChanged(element, source);\n      if (event.isPrevented()) {\n        element.val = event.prevVal;\n        element.keyframe.val = event.prevVal;\n      }\n\n      return value;\n    }\n\n    return value;\n  }\n\n  /**\n   * @param cursor to set.\n   */\n  _setCursor(cursor: string): void {\n    if (this._canvas.style.cursor != cursor) {\n      this._canvas.style.cursor = cursor;\n    }\n  }\n\n  /**\n   * Set pan mode\n   * @param isPan\n   */\n  public setInteractionMode(mode: TimelineInteractionMode): void {\n    if (this._interactionMode != mode) {\n      this._interactionMode = mode;\n      // Avoid any conflicts with other modes:\n      this._cleanUpSelection();\n    }\n  }\n  /**\n   * Get current interaction mode.\n   */\n  public getInteractionMode(): TimelineInteractionMode {\n    return this._interactionMode;\n  }\n  _convertToElement(row: TimelineRow, keyframe: TimelineKeyframe): TimelineElement {\n    const data = {\n      type: TimelineElementType.Keyframe,\n      val: keyframe.val,\n      keyframe: keyframe,\n      row: row,\n    } as TimelineElement;\n    return data;\n  }\n\n  public getSelectedKeyframes(): Array<TimelineKeyframe> {\n    return this._mapKeyframes(this.getSelectedElements());\n  }\n\n  public getSelectedElements(): Array<TimelineElement> {\n    const selected: Array<TimelineElement> = [];\n    this._forEachKeyframe((keyframe): void => {\n      if (keyframe && keyframe.model.selected) {\n        selected.push(this._convertToElement(keyframe.parentRow.model, keyframe.model));\n      }\n      return;\n    });\n\n    return selected;\n  }\n  public getAllKeyframes(): Array<TimelineKeyframe> {\n    const selected: Array<TimelineKeyframe> = [];\n    this._forEachKeyframe((keyframe): void => {\n      selected.push(keyframe.model);\n    });\n\n    return selected;\n  }\n\n  public selectAllKeyframes(): TimelineSelectionResults {\n    return this.select(this.getAllKeyframes(), TimelineSelectionMode.Normal);\n  }\n  public deselectAll(): TimelineSelectionResults {\n    return this.select(null);\n  }\n\n  private _changeNodeState(state: TimelineSelectionResults, node: TimelineKeyframe, value: boolean): boolean {\n    if (node.selected !== value) {\n      const selectable = typeof node.selectable === 'boolean' ? node.selectable : true;\n      if (!value || (value && selectable)) {\n        node.selected = value;\n        state.changed.push(node);\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  public select(nodes: TimelineKeyframe[] | TimelineKeyframe | null, mode = TimelineSelectionMode.Normal): TimelineSelectionResults {\n    const results = this._selectInternal(nodes, mode);\n    if (results.selectionChanged) {\n      this.redraw();\n    }\n    return results;\n  }\n\n  /**\n   * Select keyframes\n   * @param nodes keyframe or list of the keyframes to be selected.\n   * @param mode selection mode.\n   */\n  public _selectInternal(nodes: TimelineKeyframe[] | TimelineKeyframe | null, mode = TimelineSelectionMode.Normal): TimelineSelectionResults {\n    if (!nodes) {\n      nodes = [];\n    }\n    if (!Array.isArray(nodes)) {\n      nodes = [nodes];\n    }\n\n    const state = {\n      selectionChanged: false,\n      selected: this.getSelectedKeyframes(),\n      changed: [] as Array<any>,\n    } as TimelineSelectionResults;\n    const nodesArray = nodes as TimelineKeyframe[];\n    //const state = this.selectedSubject.getValue();\n    this.getSelectedElements();\n    if (nodesArray && mode === TimelineSelectionMode.Append) {\n      nodes.forEach((node) => {\n        const changed = this._changeNodeState(state, node, true);\n        if (changed && node.selected) {\n          state.selected.push(node);\n        }\n      });\n    } else if (nodesArray && mode === TimelineSelectionMode.Revert) {\n      nodes.forEach((node) => {\n        if (state.selected.indexOf(node) >= 0) {\n          this._changeNodeState(state, node, false);\n          TimelineUtils.deleteElement<TimelineKeyframe>(state.selected, node);\n        } else {\n          this._changeNodeState(state, node, true);\n          if (node.selected) {\n            state.selected.push(node);\n          }\n        }\n      });\n    } else if (mode === TimelineSelectionMode.Normal) {\n      const selectedItems: Array<TimelineKeyframe> = [];\n      if (nodes) {\n        nodes.forEach((node) => {\n          this._changeNodeState(state, node, true);\n          if (node.selected) {\n            selectedItems.push(node);\n          }\n        });\n      }\n\n      state.selected.forEach((node) => {\n        const exists = nodesArray.indexOf(node) >= 0;\n        // Deselect\n        if (!exists) {\n          this._changeNodeState(state, node, false);\n        }\n      });\n\n      if (state.changed.length > 0) {\n        if (selectedItems) {\n          state.selected = selectedItems;\n        } else {\n          state.selected.length = 0;\n        }\n      }\n    }\n\n    if (state.changed.length > 0) {\n      state.selectionChanged = true;\n      this._emitKeyframesSelected(state);\n    }\n\n    return state;\n  }\n\n  /**\n   * foreach visible keyframe.\n   */\n  _forEachKeyframe(callback: (keyframe: TimelineCalculatedKeyframe, index?: number, newRow?: boolean) => void): void {\n    if (!callback) {\n      return;\n    }\n    if (!this._model) {\n      return;\n    }\n\n    const calculatedModel = this._calculateModel();\n    if (!calculatedModel) {\n      return;\n    }\n\n    calculatedModel.rows.forEach((calcRow) => {\n      if (!calcRow) {\n        return;\n      }\n\n      let nextRow = true;\n      calcRow.keyframes.forEach((keyframe, keyframeIndex) => {\n        if (keyframe) {\n          callback(keyframe, keyframeIndex, nextRow);\n        }\n\n        nextRow = false;\n      });\n    });\n  }\n\n  _trackMousePos(canvas: HTMLCanvasElement, mouseArgs: MouseEvent | TouchEvent): TimelineMouseData {\n    const pos = this._getMousePos(canvas, mouseArgs) as TimelineMouseData;\n    pos.originalVal = this._mousePosToVal(pos.x, false);\n    pos.snapVal = this._mousePosToVal(pos.x, true);\n    pos.val = pos.originalVal;\n    if (this._options && this._options.snapEnabled) {\n      pos.val = pos.snapVal;\n    }\n\n    if (this._startPos) {\n      if (!this._selectionRect) {\n        this._selectionRect = {} as DOMRect;\n      }\n\n      // get the pos with the virtualization:\n      const x = Math.floor(this._startPos.x + (this._scrollStartPos.x - this.getScrollLeft()));\n      const y = Math.floor(this._startPos.y + (this._scrollStartPos.y - this.getScrollTop()));\n      this._selectionRect.x = Math.min(x, pos.x);\n      this._selectionRect.y = Math.min(y, pos.y);\n      this._selectionRect.width = Math.max(x, pos.x) - this._selectionRect.x;\n      this._selectionRect.height = Math.max(y, pos.y) - this._selectionRect.y;\n      // Once mouse was moved outside of the bounds it's not a click anymore\n      if (this._clickAllowed) {\n        this._clickAllowed = this._selectionRect.height <= this._consts.clickThreshold && this._selectionRect.width <= this._consts.clickThreshold;\n      }\n    }\n\n    return pos;\n  }\n\n  _cleanUpSelection(): void {\n    this._emitDragFinishedEvent();\n    this._startPos = null;\n    this._drag = null;\n    this._startedDragWithCtrl = false;\n    this._startedDragWithShiftKey = false;\n    this._selectionRect = null;\n    this._clickTimeout = null;\n    this._scrollStartPos = null;\n    this._isPanStarted = false;\n    this._clickAllowed = false;\n    this._stopAutoPan();\n  }\n\n  /**\n   * Check whether click timeout is over.\n   */\n  _clickTimeoutIsOver(): boolean {\n    // Duration before the selection can be tracked.\n    if (this._clickTimeout && Date.now() - this._clickTimeout > this._consts.clickDetectionMs) {\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Automatically pan. Scroll canvas when selection is made and mouse outside of the bounds.\n   */\n  _startAutoPan(): void {\n    if (this._consts.autoPanSpeed) {\n      if (!this._intervalRef) {\n        // Repeat move calls to\n        this._intervalRef = window.setInterval(() => {\n          this._handleMouseMoveEvent(null);\n        }, this._consts.autoPanSpeed);\n      }\n    }\n  }\n\n  /**\n   * Stop current running auto pan\n   */\n  _stopAutoPan(): void {\n    if (this._intervalRef) {\n      clearInterval(this._intervalRef);\n      this._intervalRef = null;\n    }\n\n    this._autoPanLastActionDate = null;\n  }\n\n  /**\n   * Check whether auto pan should be slowed down a bit.\n   */\n  _checkUpdateSpeedTooFast(): boolean {\n    // Slow down updated a bit.\n    if (this._autoPanLastActionDate && Date.now() - this._autoPanLastActionDate <= 10) {\n      return true;\n    }\n\n    this._autoPanLastActionDate = Date.now();\n    return false;\n  }\n\n  _scrollByPan(start: TimelineMouseData, pos: TimelineMouseData, scrollStartPos: DOMPoint): void {\n    if (!start || !pos) {\n      return;\n    }\n\n    const offsetX = Math.round(start.x - pos.x);\n    const newLeft = scrollStartPos.x + offsetX;\n\n    if (offsetX > 0) {\n      this._rescaleInternal(newLeft + this._width());\n    }\n\n    if (offsetX > 0 && newLeft + this._width() >= this._scrollContainer.scrollWidth - 5) {\n      this._scrollContainer.scrollLeft = this._scrollContainer.scrollWidth;\n    } else {\n      this._scrollContainer.scrollLeft = newLeft;\n    }\n    this._scrollContainer.scrollTop = Math.round(scrollStartPos.y + start.y - pos.y);\n  }\n\n  _scrollBySelectionOutOfBounds(pos: DOMPoint): boolean {\n    const x = pos.x;\n    const y = pos.y;\n    let isChanged = false;\n    let speedX = 0;\n    let speedY = 0;\n    // Small offset to start auto pan earlier.\n    const bounds = this._consts.autoPanByScrollPadding;\n    const isLeft = x <= bounds;\n    const isRight = x >= this._width() - bounds;\n    const isTop = y <= bounds;\n    const isBottom = y >= this._height() - bounds;\n    let newWidth = null;\n    let newHeight = null;\n    if (isLeft || isRight || isTop || isBottom) {\n      // Auto move init\n      this._startAutoPan();\n\n      if (this._checkUpdateSpeedTooFast()) {\n        return false;\n      }\n\n      const scrollSpeedMultiplier = isNaN(this._consts.scrollByDragSpeed) ? 1 : this._consts.scrollByDragSpeed;\n      if (isLeft) {\n        // Get normalized speed.\n        speedX = -TimelineUtils.getDistance(x, bounds) * scrollSpeedMultiplier;\n      } else if (isRight) {\n        // Get normalized speed:\n        speedX = TimelineUtils.getDistance(x, this._width() - bounds) * scrollSpeedMultiplier;\n        newWidth = this.getScrollLeft() + this._width() + speedX;\n      }\n\n      if (isTop) {\n        // Get normalized speed.\n        speedY = (-TimelineUtils.getDistance(x, bounds) * scrollSpeedMultiplier) / 4;\n      } else if (isBottom) {\n        // Get normalized speed:\n        speedY = (TimelineUtils.getDistance(x, this._height() - bounds) * scrollSpeedMultiplier) / 4;\n        newHeight = this._scrollContainer.scrollTop + this._height();\n      }\n    } else {\n      this._stopAutoPan();\n    }\n\n    if (newWidth || newHeight) {\n      this._rescaleInternal(newWidth, newHeight, 'scrollBySelection');\n    }\n\n    if (Math.abs(speedX) > 0) {\n      this._scrollContainer.scrollLeft += speedX;\n      isChanged = true;\n    }\n\n    if (Math.abs(speedY) > 0) {\n      this._scrollContainer.scrollTop += speedY;\n      isChanged = true;\n    }\n\n    return isChanged;\n  }\n\n  /**\n   * Convert screen pixel to value.\n   */\n  public pxToVal(px: number): number {\n    if (!this._options) {\n      return px;\n    }\n    let min = this._options.min;\n    if (!TimelineUtils.isNumber(min)) {\n      min = 0;\n    }\n    min *= this._currentZoom || 1;\n    const steps = this._options.stepVal * this._currentZoom || 1;\n    const val = min + (px / this._options.stepPx) * steps;\n    return val;\n  }\n\n  /**\n   * Convert value to local screen component coordinates.\n   */\n  _toScreenPx(val: number): number {\n    return this.valToPx(val) - this.getScrollLeft() + this._leftMargin();\n  }\n  /**\n   * Convert screen local coordinates to a global value info.\n   */\n  _fromScreen(px: number): number {\n    return this.pxToVal(this.getScrollLeft() + px - this._leftMargin());\n  }\n  /**\n   * Convert area value to global screen pixel coordinates.\n   */\n  public valToPx(val: number): number {\n    if (!this._options) {\n      return val;\n    }\n    let min = this._options.min;\n    if (!TimelineUtils.isNumber(min)) {\n      min = 0;\n    }\n    min *= this._currentZoom || 1;\n    const steps = this._options.stepVal * this._currentZoom || 1;\n    return (-min + val) * (this._options.stepPx / steps);\n  }\n\n  /**\n   * Snap a value to a nearest grid point.\n   */\n  public snapVal(val: number): number {\n    // Snap a value if configured.\n    if (this._options && this._options.snapEnabled && this._options.snapStep) {\n      const stops = this._options.snapStep;\n      const step = val / stops;\n      const stepsFit = Math.round(step);\n      const minSteps = Math.abs(this._options.min) / this._options.snapStep;\n      const minOffset = TimelineUtils.sign(this._options.min) * (minSteps - Math.floor(minSteps)) * this._options.snapStep;\n      val = Math.round(minOffset) + Math.round(stepsFit * stops);\n    }\n\n    val = TimelineUtils.keepInBounds(val, this._options.min, this._options.max);\n    return val;\n  }\n\n  _mousePosToVal(x: number, snapEnabled = false): number {\n    const mousePos = Math.min(x, this._width());\n    let convertedVal = this._fromScreen(mousePos);\n    convertedVal = Math.round(convertedVal);\n    if (snapEnabled) {\n      convertedVal = this.snapVal(convertedVal);\n    }\n\n    return convertedVal;\n  }\n\n  /**\n   * Format line gauge text.\n   * Default formatting is HMS\n   * @param ms milliseconds to convert.\n   * @param isSeconds whether seconds are passed.\n   */\n  _formatUnitsText(ms: number, isSeconds = false): string {\n    const sign = TimelineUtils.sign(ms) < 0 ? '-' : '';\n    ms = Math.abs(ms);\n    // 1- Convert to seconds:\n    let seconds = ms / 1000;\n    if (isSeconds) {\n      seconds = ms;\n    }\n\n    const year = Math.floor(seconds / (365 * 86400));\n    seconds = seconds % (365 * 86400);\n\n    const days = Math.floor(seconds / 86400);\n    seconds = seconds % 86400;\n\n    // 2- Extract hours:\n    const hours = Math.floor(seconds / 3600); // 3,600 seconds in 1 hour\n    seconds = seconds % 3600; // seconds remaining after extracting hours\n    // 3- Extract minutes:\n    const minutes = Math.floor(seconds / 60); // 60 seconds in 1 minute\n    // 4- Keep only seconds not extracted to minutes:\n    seconds = seconds % 60;\n    let str = '';\n    if (year) {\n      str += year + ':';\n    }\n\n    if (days) {\n      str += days + ':';\n    }\n\n    if (hours) {\n      str += hours + ':';\n    }\n\n    if (minutes) {\n      str += minutes + ':';\n    }\n\n    if (!isNaN(seconds)) {\n      str += seconds;\n    }\n\n    return sign + str;\n  }\n  /**\n   * Left padding of the timeline.\n   */\n  _leftMargin(): number {\n    if (!this._options) {\n      return 0;\n    }\n    return this._options.leftMargin || 0;\n  }\n  _renderTicks(): void {\n    const rulerActive = !!this._ctx && !!this._options && !!this._ctx.canvas && this._ctx.canvas.clientWidth > 0 && this._ctx.canvas.clientHeight > 0 && this._options.stepPx;\n    if (!rulerActive) {\n      return;\n    }\n    const screenWidth = this._width() - this._leftMargin();\n    let from = this.pxToVal(this.getScrollLeft());\n    let to = this.pxToVal(this.getScrollLeft() + screenWidth);\n    if (isNaN(from) || isNaN(to) || from === to) {\n      return;\n    }\n\n    if (to < from) {\n      const wasToVal = to;\n      to = from;\n      from = wasToVal;\n    }\n\n    const valDistance = TimelineUtils.getDistance(from, to);\n    if (valDistance <= 0) {\n      return;\n    }\n\n    // Find the nearest 'beautiful' step for a gauge.\n    // 'beautiful' step should be dividable by 1/2/5/10!\n    const step = TimelineUtils.findGoodStep(valDistance / (screenWidth / this._options.stepPx));\n    const smallStep = TimelineUtils.findGoodStep(valDistance / (screenWidth / this._options.stepSmallPx));\n\n    // Find beautiful start point:\n    const fromVal = Math.floor(from / step) * step;\n\n    // Find a beautiful end point:\n    const toVal = Math.ceil(to / step) * step + step;\n\n    if (!TimelineUtils.isNumber(step) || step <= 0 || Math.abs(toVal - fromVal) === 0) {\n      return;\n    }\n\n    let lastTextStart = 0;\n    this._ctx.save();\n    const headerHeight = TimelineStyleUtils.headerHeight(this._options);\n    const tickHeight = headerHeight / 2;\n    const smallTickHeight = headerHeight / 1.3;\n    for (let i = fromVal; i <= toVal; i += step) {\n      // local\n      const sharpPos = this._getSharp(this._toScreenPx(i));\n      this._ctx.save();\n      this._ctx.beginPath();\n      this._ctx.setLineDash([4]);\n      this._ctx.lineWidth = 1;\n      this._ctx.strokeStyle = this._options.tickColor;\n      TimelineUtils.drawLine(this._ctx, sharpPos, tickHeight, sharpPos, headerHeight);\n      this._ctx.stroke();\n\n      this._ctx.fillStyle = this._options.labelsColor;\n      if (this._options.font) {\n        this._ctx.font = this._options.font;\n      }\n\n      const text = this._formatUnitsText(i);\n      const textSize = this._ctx.measureText(text);\n\n      const textX = sharpPos - textSize.width / 2;\n      // skip text render if there is no space for it.\n      if (isNaN(lastTextStart) || lastTextStart <= textX) {\n        lastTextStart = textX + textSize.width;\n        this._ctx.fillText(text, textX, 10);\n      }\n\n      this._ctx.restore();\n      if (!TimelineUtils.isNumber(smallStep) || smallStep <= 0) {\n        continue;\n      }\n      // Draw small steps\n      for (let x = i + smallStep; x < i + step; x += smallStep) {\n        // local\n        const nextSharpPos = this._getSharp(this._toScreenPx(x));\n        this._ctx.beginPath();\n        this._ctx.lineWidth = this._pixelRatio;\n        this._ctx.strokeStyle = this._options.tickColor;\n        TimelineUtils.drawLine(this._ctx, nextSharpPos, smallTickHeight, nextSharpPos, headerHeight);\n        this._ctx.stroke();\n      }\n    }\n\n    this._ctx.restore();\n  }\n\n  /**\n   * calculate virtual mode. Determine screen positions for the elements.\n   */\n  _calculateModel(): TimelineModelCalcResults {\n    const toReturn = {\n      rows: [],\n      size: {\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n      } as DOMRect,\n      min: null,\n      max: null,\n      keyframes: [] as Array<TimelineCalculatedKeyframe>,\n    } as TimelineModelCalcResults;\n\n    if (!this._model) {\n      return toReturn;\n    }\n    const rows = this._model.rows;\n    if (!rows || !Array.isArray(rows) || rows.length <= 0) {\n      return toReturn;\n    }\n    let rowAbsoluteHeight = TimelineStyleUtils.headerHeight(this._options);\n    rows.forEach((row, index) => {\n      if (!row || row.hidden) {\n        return;\n      }\n\n      // draw with scroll virtualization:\n      const rowHeight = TimelineStyleUtils.getRowHeight(row, this._options);\n      const marginBottom = TimelineStyleUtils.getRowMarginBottom(row, this._options);\n      const currentRowY = rowAbsoluteHeight - (this._scrollContainer ? this._scrollContainer.scrollTop : 0);\n      rowAbsoluteHeight += rowHeight + marginBottom;\n      if (index == 0) {\n        toReturn.size.y = currentRowY;\n      }\n\n      toReturn.size.height = Math.max(rowAbsoluteHeight + rowHeight, toReturn.size.height);\n\n      const calcRow = {\n        size: { x: 0, y: currentRowY, width: this._canvas ? this._width() : 0, height: rowHeight } as DOMRect,\n        marginBottom: marginBottom,\n        model: row,\n        min: null,\n        max: null,\n        groups: [] as Array<TimelineCalculatedGroup>,\n        keyframes: [] as Array<TimelineCalculatedKeyframe>,\n      } as TimelineCalculatedRow;\n      toReturn.rows.push(calcRow);\n      if (!row.keyframes || !row.keyframes.forEach || row.keyframes.length <= 0) {\n        return;\n      }\n\n      // Get min and max ms to draw keyframe rows:\n      if (row && row.keyframes) {\n        row.keyframes.forEach((keyframe) => {\n          if (keyframe && !isNaN(keyframe.val) && !keyframe.hidden) {\n            let currentGroup: TimelineCalculatedGroup = null;\n            for (let i = 0; i < calcRow.groups.length; i++) {\n              const existingGroup = calcRow.groups[i];\n              if (keyframe.group === existingGroup.group) {\n                currentGroup = existingGroup;\n                break;\n              }\n            }\n            if (!currentGroup) {\n              currentGroup = {\n                min: null,\n                max: null,\n                group: keyframe.group,\n                keyframes: [] as Array<TimelineCalculatedKeyframe>,\n              } as TimelineCalculatedGroup;\n\n              calcRow.groups.push(currentGroup);\n            }\n            const keyframeSize = this._getKeyframePosition(keyframe, calcRow);\n            const calcKeyframe = {\n              model: keyframe,\n              parentRow: calcRow,\n              parentGroup: currentGroup,\n              size: keyframeSize,\n            } as TimelineCalculatedKeyframe;\n\n            const min = currentGroup.min == null ? keyframe.val : Math.min(keyframe.val, currentGroup.min);\n            const max = currentGroup.max == null ? keyframe.val : Math.max(keyframe.val, currentGroup.max);\n            if (!isNaN(min)) {\n              currentGroup.min = min;\n            }\n            if (!isNaN(max)) {\n              currentGroup.max = max;\n            }\n            calcRow.keyframes.push(calcKeyframe);\n            currentGroup.keyframes.push(calcKeyframe);\n            toReturn.keyframes.push(calcKeyframe);\n          }\n        });\n      }\n\n      calcRow.groups.forEach((group) => {\n        // Extend row min max bounds by a group bounds:\n        TimelineUtils.setMinMax(calcRow, group, true);\n        // get group screen coords\n        const groupRect = this._getKeyframesGroupSize(row, calcRow.size.y, group.min, group.max);\n        group.size = groupRect;\n      });\n\n      // Extend screen bounds by a current calculation:\n      TimelineUtils.setMinMax(toReturn, calcRow, true);\n    });\n    if (TimelineUtils.isNumber(toReturn.max)) {\n      toReturn.size.width = this.valToPx(toReturn.max);\n    }\n    return toReturn;\n  }\n\n  _renderRows(): void {\n    const data = this._calculateModel();\n    if (data && data.rows) {\n      this._ctx.save();\n      data.rows.forEach((rowCalc) => {\n        if (!rowCalc) {\n          return;\n        }\n\n        this._ctx.fillStyle = TimelineStyleUtils.getRowFillColor(rowCalc.model, this._options);\n        //this._ctx.fillRect(data.areaRect.x, data.areaRect.y, data.areaRect.w, data.areaRect.h);\n        // Note: bounds used instead of the clip while clip is slow!\n        const bounds = this._cutBounds(rowCalc.size);\n        if (bounds) {\n          this._ctx.fillRect(bounds.x, bounds.y, bounds.width, bounds.height);\n        }\n\n        const keyframeLaneColor = TimelineStyleUtils.groupFillColor(rowCalc.model, this._options);\n        if (!rowCalc.groups) {\n          return;\n        }\n        rowCalc.groups.forEach((group) => {\n          // get the bounds on a canvas\n          const rectBounds = this._cutBounds(group.size);\n          if (rectBounds) {\n            this._ctx.fillStyle = keyframeLaneColor;\n            this._ctx.fillRect(rectBounds.x, rectBounds.y, rectBounds.width, rectBounds.height);\n          }\n        });\n      });\n\n      this._ctx.restore();\n    }\n  }\n\n  /**\n   * Method is used for the optimization.\n   * Only visible part should be rendered.\n   */\n  _cutBounds(rect: DOMRect): TimelineCutBoundsRectResults {\n    if (!rect) {\n      return null;\n    }\n    // default bounds: minX, maxX, minY, maxY\n    const minX = 0,\n      maxX = this._width(),\n      minY = TimelineStyleUtils.headerHeight(this._options),\n      maxY = this._width();\n\n    if (\n      TimelineUtils.isRectOverlap(rect, {\n        x: minX,\n        y: minY,\n        width: TimelineUtils.getDistance(minX, maxX),\n        height: TimelineUtils.getDistance(minY, maxY),\n      } as DOMRect)\n    ) {\n      const y = Math.max(rect.y, minY);\n      const x = Math.max(rect.x, minX);\n      const offsetW = rect.x - x;\n      const offsetH = rect.y - y;\n\n      return {\n        height: rect.height + offsetH,\n        width: rect.width + offsetW,\n        x: x,\n        y: y,\n        overlapY: Math.abs(offsetH) > 0,\n        overlapX: Math.abs(offsetW) > 0,\n      } as TimelineCutBoundsRectResults;\n    }\n    return null;\n  }\n\n  /**\n   * get keyframe group screen rect coordinates.\n   * @param row\n   * @param rowY row screen coords y position\n   */\n  _getKeyframesGroupSize(row: TimelineRow, rowY: number, minValue: number, maxValue: number): DOMRect {\n    let groupHeight: number | string = TimelineStyleUtils.rowGroupHeight(row, this._options);\n\n    const height = TimelineStyleUtils.getRowHeight(row, this._options);\n    if ((!groupHeight && groupHeight !== 0) || isNaN(groupHeight as number) || groupHeight == 'auto') {\n      groupHeight = Math.floor(height * 0.7);\n    }\n\n    if (groupHeight > height) {\n      groupHeight = height;\n    }\n\n    const margin = height - (groupHeight as number);\n    // draw keyframes rows.\n    const xMin = this._toScreenPx(minValue); // local\n    const xMax = this._toScreenPx(maxValue); // local\n\n    return {\n      x: xMin,\n      y: rowY + Math.floor(margin / 2),\n      height: groupHeight,\n      width: TimelineUtils.getDistance(xMin, xMax),\n    } as DOMRect;\n  }\n\n  _getKeyframePosition(keyframe: TimelineKeyframe, rowCalculated: TimelineCalculatedRow): DOMRect | null {\n    if (!keyframe) {\n      console.log('keyframe should be defined.');\n      return null;\n    }\n\n    const val = keyframe.val;\n    if (isNaN(val)) {\n      return null;\n    }\n\n    const rowSize = rowCalculated.size;\n    // get center of the lane:\n    const y = rowSize.y + rowSize.height / 2;\n\n    let height: number | string = TimelineStyleUtils.getKeyframeStyle(keyframe, rowCalculated.model, this._options, 'height', 'auto');\n    let width: number | string = TimelineStyleUtils.getKeyframeStyle(keyframe, rowCalculated.model, this._options, 'width', 'auto');\n\n    if (height == 'auto') {\n      height = rowSize.height / 3;\n    }\n    if (width == 'auto') {\n      width = height;\n    }\n    if (height > 0) {\n      if (!isNaN(val)) {\n        const toReturn = {\n          x: Math.floor(this._toScreenPx(val)), // local\n          y: Math.floor(y),\n          height: height,\n          width: width,\n        } as DOMRect;\n        return toReturn;\n      }\n    }\n\n    return null;\n  }\n\n  _renderKeyframes(): void {\n    this._forEachKeyframe((calcKeyframe): boolean => {\n      const row = calcKeyframe.parentRow.model;\n      const pos = calcKeyframe.size;\n      const keyframe = calcKeyframe.model;\n      if (pos) {\n        let x = this._getSharp(pos.x);\n        let y = pos.y;\n        const bounds = this._cutBounds({\n          x: x - pos.width / 2,\n          y: y - pos.height / 2,\n          width: pos.width,\n          height: pos.height,\n        } as DOMRect);\n        if (!bounds) {\n          return;\n        }\n\n        this._ctx.save();\n\n        // Performance FIX: use clip only  when we are in the collision! Clip is slow!\n        // Other keyframes should be hidden by bounds check.\n        if (bounds && bounds.overlapY) {\n          this._ctx.beginPath();\n          this._ctx.rect(0, TimelineStyleUtils.headerHeight(this._options), this._width(), this._width());\n          this._ctx.clip();\n        }\n\n        const shape = TimelineStyleUtils.keyframeShape(keyframe, row, this._options);\n        if (shape === TimelineKeyframeShape.None) {\n          return;\n        }\n\n        const keyframeColor = keyframe.selected ? TimelineStyleUtils.keyframeSelectedFillColor(keyframe, row, this._options) : TimelineStyleUtils.keyframeFillColor(keyframe, row, this._options);\n        const border = TimelineStyleUtils.keyframeStrokeThickness(keyframe, row, this._options);\n        const strokeColor =\n          border > 0 ? (keyframe.selected ? TimelineStyleUtils.keyframeSelectedStrokeColor(keyframe, row, this._options) : TimelineStyleUtils.keyframeStrokeColor(keyframe, row, this._options)) : '';\n\n        if (shape == TimelineKeyframeShape.Rhomb) {\n          this._ctx.beginPath();\n          this._ctx.translate(x, y);\n          this._ctx.rotate((45 * Math.PI) / 180);\n          if (border > 0 && strokeColor) {\n            this._ctx.fillStyle = strokeColor;\n            this._ctx.rect(-pos.width / 2, -pos.height / 2, pos.width, pos.height);\n            this._ctx.fill();\n          }\n\n          this._ctx.fillStyle = keyframeColor;\n          // draw main keyframe data with offset.\n          this._ctx.translate(border, border);\n          this._ctx.rect(-pos.width / 2, -pos.height / 2, pos.width - border * 2, pos.height - border * 2);\n          this._ctx.fill();\n        } else if (shape == TimelineKeyframeShape.Circle) {\n          this._ctx.beginPath();\n          if (border > 0 && strokeColor) {\n            this._ctx.fillStyle = strokeColor;\n            this._ctx.arc(x, y, pos.height, 0, 2 * Math.PI);\n          }\n          this._ctx.fillStyle = keyframeColor;\n          this._ctx.arc(x, y, pos.height - border, 0, 2 * Math.PI);\n          this._ctx.fill();\n        } else if (shape == TimelineKeyframeShape.Rect) {\n          this._ctx.beginPath();\n          y = y - pos.height / 2;\n          x = x - pos.width / 2;\n          if (border > 0 && strokeColor) {\n            this._ctx.fillStyle = strokeColor;\n            this._ctx.rect(x, y, pos.width, pos.height);\n            this._ctx.fill();\n          }\n\n          this._ctx.fillStyle = keyframeColor;\n          this._ctx.rect(x + border, y + border, pos.width - border, pos.height - border);\n          this._ctx.fill();\n        }\n\n        this._ctx.restore();\n      }\n      return;\n    });\n  }\n\n  _renderSelectionRect(): void {\n    if (this._drag) {\n      return;\n    }\n\n    this._ctx.save();\n    const thickness = 1;\n    if (this._selectionRect && this._selectionRectEnabled) {\n      this._ctx.setLineDash([4]);\n      this._ctx.lineWidth = this._pixelRatio;\n      this._ctx.strokeStyle = this._options.selectionColor;\n      this._ctx.strokeRect(\n        this._getSharp(this._selectionRect.x, thickness),\n        this._getSharp(this._selectionRect.y, thickness),\n        Math.floor(this._selectionRect.width),\n        Math.floor(this._selectionRect.height),\n      );\n    }\n    this._ctx.restore();\n  }\n\n  _renderBackground(): void {\n    if (this._options.fillColor) {\n      this._ctx.save();\n      this._ctx.beginPath();\n      this._ctx.rect(0, 0, this._width(), this._height());\n      this._ctx.fillStyle = this._options.fillColor;\n      this._ctx.fill();\n      this._ctx.restore();\n    } else {\n      // Clear if bg not set.\n      this._ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);\n    }\n  }\n\n  _renderTimeline(): void {\n    if (!this._ctx || !this._options || !this._options.timelineStyle) {\n      return;\n    }\n    const style = this._options.timelineStyle;\n    this._ctx.save();\n    const thickness = style.width || 1;\n    this._ctx.lineWidth = thickness * this._pixelRatio;\n    const timeLinePos = this._getSharp(this._toScreenPx(this._val), thickness);\n    this._ctx.strokeStyle = style.strokeColor;\n    this._ctx.fillStyle = style.fillColor;\n    const y = style.marginTop;\n    this._ctx.beginPath();\n    TimelineUtils.drawLine(this._ctx, timeLinePos, y, timeLinePos, this._height());\n    this._ctx.stroke();\n\n    if (style.capHeight && style.capWidth) {\n      const rectSize = style.capWidth;\n      const capHeight = style.capHeight;\n      if (style.capType === TimelineCapShape.Triangle) {\n        this._ctx.beginPath();\n        this._ctx.moveTo(timeLinePos - rectSize / 2, y);\n        this._ctx.lineTo(timeLinePos + rectSize / 2, y);\n        this._ctx.lineTo(timeLinePos, capHeight);\n        this._ctx.closePath();\n        this._ctx.stroke();\n      } else if (style.capType === TimelineCapShape.Rect) {\n        this._ctx.fillRect(timeLinePos - rectSize / 2, y, rectSize, capHeight);\n        this._ctx.fill();\n      }\n    }\n\n    this._ctx.restore();\n  }\n\n  _renderHeaderBackground(): void {\n    if (!this._ctx || !this._options) {\n      return;\n    }\n    if (TimelineStyleUtils.headerHeight(this._options)) {\n      this._ctx.save();\n      // draw ticks background\n      this._ctx.lineWidth = this._pixelRatio;\n      if (this._options.headerFillColor) {\n        // draw ticks background\n        this._ctx.lineWidth = this._pixelRatio;\n        // draw header background\n        this._ctx.fillStyle = this._options.headerFillColor;\n        this._ctx.fillRect(0, 0, this._width(), TimelineStyleUtils.headerHeight(this._options));\n      } else {\n        this._ctx.clearRect(0, 0, this._width(), TimelineStyleUtils.headerHeight(this._options));\n      }\n      this._ctx.restore();\n    }\n  }\n\n  redraw(): void {\n    if (window.requestAnimationFrame) {\n      window.requestAnimationFrame(this._redrawInternal);\n    } else {\n      this._redrawInternal();\n    }\n  }\n\n  /**\n   * perform scroll to max left.\n   */\n  public scrollLeft(): void {\n    if (this._scrollContainer.scrollLeft != this._scrollContainer.scrollWidth) {\n      this._scrollContainer.scrollLeft = this._scrollContainer.scrollWidth;\n    }\n  }\n\n  /**\n   * Redraw parts of the component in the specific order.\n   */\n  _redrawInternal = (): void => {\n    if (!this._ctx) {\n      return;\n    }\n    // Rescale when animation is played out of the bounds.\n    if (this.valToPx(this._val) > this._scrollContainer.scrollWidth) {\n      this.rescale();\n      if (!this._isPanStarted && this._drag && this._drag.type !== TimelineElementType.Timeline) {\n        this.scrollLeft();\n      }\n    }\n\n    this._renderBackground();\n    this._renderRows();\n    // Render after rows\n    this._renderHeaderBackground();\n    this._renderTicks();\n    this._renderKeyframes();\n    this._renderSelectionRect();\n    this._renderTimeline();\n  };\n\n  /**\n   * Get row by y coordinate.\n   * @param posY y screen coordinate.\n   */\n  public getRowByY(posY: number): TimelineRow {\n    const model = this._calculateModel();\n    if (model && model.rows) {\n      for (let i = 0; i < model.rows.length; i++) {\n        const row = model.rows[i].size;\n        if (row && row.y >= posY && posY <= row.y + row.height) {\n          return row;\n        }\n      }\n    }\n\n    return null;\n  }\n  /**\n   * Find sharp pixel position\n   */\n  _getSharp(pos: number, thickness = 1): number {\n    pos = Math.round(pos);\n    if (thickness % 2 == 0) {\n      return pos;\n    }\n\n    return pos + this._pixelRatio / 2;\n  }\n\n  /**\n   * Get current time:\n   */\n  public getTime(): number {\n    return this._val;\n  }\n\n  /**\n   * Set current time internal\n   * @param val value.\n   * @param source event source.\n   */\n  _setTimeInternal(val: number, source: TimelineEventSource = TimelineEventSource.Programmatically): boolean {\n    val = Math.round(val);\n    if (val < this._options.min) {\n      val = this._options.min;\n    }\n\n    if (this._val != val) {\n      const prevVal = this._val;\n      const timelineEvent = new TimelineTimeChangedEvent();\n      timelineEvent.val = val;\n      timelineEvent.prevVal = prevVal;\n      timelineEvent.source = source;\n      this._val = val;\n      this.emit(TimelineEvents.TimeChanged, timelineEvent);\n      if (timelineEvent.isPrevented()) {\n        this._val = prevVal;\n        return false;\n      }\n      return true;\n    }\n\n    return false;\n  }\n  public setTime(val: number): boolean {\n    // don't allow to change time during drag:\n    if (this._drag && this._drag.type === TimelineElementType.Timeline) {\n      return false;\n    }\n\n    const isChanged = this._setTimeInternal(val, TimelineEventSource.SetTimeMethod);\n    if (isChanged) {\n      this.rescale();\n      this.redraw();\n    }\n\n    return isChanged;\n  }\n\n  public getOptions(): TimelineOptions {\n    return this._options;\n  }\n\n  public setScrollLeft(value: number): void {\n    if (this._scrollContainer) {\n      this._scrollContainer.scrollLeft = value;\n    }\n  }\n  public setScrollTop(value: number): void {\n    if (this._scrollContainer) {\n      this._scrollContainer.scrollTop = value;\n    }\n  }\n  public getScrollLeft(): number {\n    return this._scrollContainer ? this._scrollContainer.scrollLeft : 0;\n  }\n  public getScrollTop(): number {\n    return this._scrollContainer ? this._scrollContainer.scrollTop : 0;\n  }\n\n  /**\n   * Set options and render the component.\n   * Options will be merged with the defaults and control invalidated\n   */\n  public setOptions(toSet: TimelineOptions): TimelineOptions {\n    this._options = this._setOptions(toSet);\n    this.rescale();\n    this.redraw();\n    // Merged options:\n    return this._options;\n  }\n\n  _setOptions(toSet: TimelineOptions): TimelineOptions {\n    this._options = this._mergeOptions(toSet);\n    // Normalize and validate spans per value.\n    this._options.snapStep = TimelineUtils.keepInBounds(this._options.snapStep, 0, this._options.stepVal);\n    this._currentZoom = this._setZoom(this._options.zoom, this._options.zoomMin, this._options.zoomMax);\n    this._options.min = TimelineUtils.isNumber(this._options.min) ? this._options.min : 0;\n    this._options.max = TimelineUtils.isNumber(this._options.max) ? this._options.max : Number.MAX_VALUE;\n    if (this._scrollContainer) {\n      const classList = this._scrollContainer.classList;\n      if (this._options.scrollContainerClass && classList.contains(this._options.scrollContainerClass)) {\n        classList.add(this._options.scrollContainerClass);\n      }\n      if (this._options.fillColor) {\n        this._scrollContainer.style.background = this._options.fillColor;\n      }\n    }\n    return this._options;\n  }\n\n  public getModel(): TimelineModel {\n    return this._model;\n  }\n\n  /**\n   * Set model and redraw application.\n   * @param data\n   */\n  public setModel(data: TimelineModel): void {\n    this._model = data;\n    this.rescale();\n    this.redraw();\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  _getMousePos(canvas: HTMLCanvasElement, e: TouchEvent | MouseEvent | any): TimelineMouseData {\n    let radius = 1;\n    let clientX = 0;\n    let clientY = 0;\n    if (e.changedTouches && e.changedTouches.length > 0) {\n      // TODO: implement better touch support\n      const touch = e.changedTouches[0];\n      clientX = touch.clientX;\n      clientY = touch.clientY;\n      radius = Math.max(radius, touch.radiusX, touch.radiusY);\n    } else {\n      clientX = e.clientX;\n      clientY = e.clientY;\n    }\n\n    const rect = canvas.getBoundingClientRect(), // abs. size of element\n      scaleX = canvas.width / this._pixelRatio / rect.width, // relationship bitmap vs. element for X\n      scaleY = canvas.height / this._pixelRatio / rect.height; // relationship bitmap vs. element for Y\n\n    const x = (clientX - rect.left) * scaleX;\n    const y = (clientY - rect.top) * scaleY;\n    // scale mouse coordinates after they have been adjusted to be relative to element\n    return {\n      x: x,\n      y: y,\n      radius,\n      args: e,\n    } as TimelineMouseData;\n  }\n\n  /**\n   * Apply container div size to the container on changes detected.\n   */\n  _updateCanvasScale(): boolean {\n    if (!this._scrollContainer || !this._ctx) {\n      console.log('control should be initialized first');\n      return;\n    }\n    let changed = false;\n    const width = this._scrollContainer.clientWidth * this._pixelRatio;\n    const height = this._scrollContainer.clientHeight * this._pixelRatio;\n    if (Math.floor(width) != Math.floor(this._ctx.canvas.width)) {\n      this._ctx.canvas.width = width;\n      changed = true;\n    }\n\n    if (Math.floor(height) != Math.floor(this._ctx.canvas.height)) {\n      this._ctx.canvas.height = height;\n      changed = true;\n    }\n\n    if (changed) {\n      this._ctx.setTransform(this._pixelRatio, 0, 0, this._pixelRatio, 0, 0);\n    }\n    return changed;\n  }\n\n  /**\n   * Rescale and update size of the container.\n   */\n  public rescale(): void {\n    this._rescaleInternal();\n  }\n\n  _rescaleInternal(newWidth: number | null = null, newHeight: number | null = null, scrollMode = 'default'): void {\n    this._updateCanvasScale();\n    const data = this._calculateModel();\n    if (data && data.size) {\n      const additionalOffset = this._options.stepPx;\n      newWidth = newWidth || 0;\n      // not less than current timeline position\n      const timelineGlobalPos = this.valToPx(this._val);\n      let timelinePos = 0;\n      if (timelineGlobalPos > this._width()) {\n        if (scrollMode == 'scrollBySelection') {\n          timelinePos = Math.floor(timelineGlobalPos + this._width() + (this._options.stepPx || 0));\n        } else {\n          timelinePos = Math.floor(timelineGlobalPos + this._width() / 1.5);\n        }\n      }\n      const keyframeW = data.size.width + this._leftMargin() + additionalOffset;\n\n      newWidth = Math.max(\n        newWidth,\n        // keyframes size\n        keyframeW,\n        // not less than current scroll position\n        this.getScrollLeft() + this._width(),\n        timelinePos,\n      );\n\n      const minWidthPx = Math.floor(newWidth) + 'px';\n      if (minWidthPx != this._scrollContent.style.minWidth) {\n        this._scrollContent.style.minWidth = minWidthPx;\n      }\n\n      newHeight = Math.max(Math.floor(data.size.height + this._height() * 0.2), this._scrollContainer.scrollTop + this._height() - 1, Math.round(newHeight || 0));\n\n      const h = newHeight + 'px';\n      if (this._scrollContent.style.minHeight != h) {\n        this._scrollContent.style.minHeight = h;\n      }\n    }\n  }\n\n  /**\n   * get draggable element.\n   * Filter elements and get first element by a priority.\n   * @param Array\n   * @param val current mouse value\n   */\n  _findDraggable(elements: Array<TimelineElement>, val: number | null = null): TimelineElement {\n    // filter and sort: Timeline, individual keyframes, groups (distance).\n    const getPriority = (type: TimelineElementType): number => {\n      if (type === TimelineElementType.Timeline) {\n        return 1;\n      } else if (type === TimelineElementType.Keyframe) {\n        return 2;\n      } else if (type === TimelineElementType.Group) {\n        return 3;\n      }\n      return -1;\n    };\n    const filteredElements = elements.filter((element) => {\n      if (!element) {\n        return false;\n      }\n      if (element.type === TimelineElementType.Keyframe) {\n        if (!TimelineStyleUtils.keyframeDraggable(element.keyframe, element.row, this._options)) {\n          return false;\n        }\n      } else if (element.type === TimelineElementType.Group) {\n        if (!TimelineStyleUtils.groupDraggable(element.row, this._options)) {\n          return false;\n        }\n      } else if (element.type === TimelineElementType.Row) {\n        return false;\n      }\n      return true;\n    });\n\n    const sorted = filteredElements.sort((a, b): number => {\n      let prioA = getPriority(a.type);\n      let prioB = getPriority(b.type);\n      if (prioA === prioB) {\n        if (val === null) {\n          return 0;\n        }\n\n        // Sort by distance\n        prioA = TimelineUtils.getDistance(a.val, val);\n        prioB = TimelineUtils.getDistance(b.val, val);\n        if (prioA === prioB) {\n          return 0;\n        }\n        return prioA < prioB ? 1 : -1;\n      }\n\n      return prioA < prioB ? 1 : -1;\n    });\n    if (sorted.length > 0) {\n      return sorted[sorted.length - 1];\n    }\n\n    return null;\n  }\n\n  /**\n   * get all clickable elements by a screen point.\n   */\n  public elementFromPoint(pos: DOMPoint, clickRadius = 2): Array<TimelineElement> {\n    clickRadius = Math.max(clickRadius, 1);\n    const toReturn: Array<TimelineElement> = [];\n\n    if (!pos) {\n      return toReturn;\n    }\n\n    const headerHeight = TimelineStyleUtils.headerHeight(this._options);\n    // Check whether we can drag timeline.\n    const timeLinePos = this._toScreenPx(this._val);\n    let width = 0;\n    if (this._options && this._options.timelineStyle) {\n      const timelineStyle = this._options.timelineStyle;\n      width = Math.max((timelineStyle.width || 1) * this._pixelRatio, (timelineStyle.capWidth || 0) * this._pixelRatio || 1) + clickRadius;\n    }\n    // Allow to select timeline only by half of a header to allow select by a selector top most keyframes row.\n    if (pos.y <= headerHeight * 0.5 || (pos.x >= timeLinePos - width / 2 && pos.x <= timeLinePos + width / 2)) {\n      toReturn.push({\n        val: this._val,\n        type: TimelineElementType.Timeline,\n      } as TimelineElement);\n    }\n    const snap = this._options.snapEnabled;\n    if (pos.y >= headerHeight && this._options.keyframesDraggable) {\n      this._forEachKeyframe((calcKeyframe, index, isNextRow): void => {\n        // Check keyframes group overlap\n        if (isNextRow) {\n          const rowOverlapped = TimelineUtils.isOverlap(pos.x, pos.y, calcKeyframe.parentRow.size);\n          if (rowOverlapped) {\n            const row = {\n              val: this._mousePosToVal(pos.x, snap),\n              keyframes: calcKeyframe.parentRow.model.keyframes,\n              type: TimelineElementType.Row,\n              row: calcKeyframe.parentRow.model,\n            } as TimelineElement;\n            toReturn.push(row);\n          }\n          if (calcKeyframe.parentRow.groups) {\n            calcKeyframe.parentRow.groups.forEach((group) => {\n              const keyframesGroupOverlapped = TimelineUtils.isOverlap(pos.x, pos.y, group.size);\n              if (keyframesGroupOverlapped) {\n                const keyframesModels = this._mapKeyframes(group.keyframes);\n                const groupElement = {\n                  val: this._mousePosToVal(pos.x, snap),\n                  type: TimelineElementType.Group,\n                  group: group,\n                  row: calcKeyframe.parentRow.model,\n                  keyframes: keyframesModels,\n                } as TimelineElement;\n\n                const snapped = this.snapVal(group.min);\n                // get snapped mouse pos based on a min value.\n                groupElement.val += group.min - snapped;\n                toReturn.push(groupElement);\n              }\n            });\n          }\n        }\n\n        const keyframePos = calcKeyframe.size;\n        if (keyframePos) {\n          const dist = TimelineUtils.getDistance(keyframePos.x, keyframePos.y, pos.x, pos.y);\n          if (dist <= keyframePos.height + clickRadius) {\n            toReturn.push({\n              keyframe: calcKeyframe.model,\n              keyframes: [calcKeyframe.model],\n              val: calcKeyframe.model.val,\n              row: calcKeyframe.parentRow.model,\n              type: TimelineElementType.Keyframe,\n            } as TimelineElement);\n          }\n        }\n        return;\n      });\n    }\n    return toReturn;\n  }\n\n  /**\n   * Merge options with the defaults.\n   */\n  _mergeOptions(from: TimelineOptions): TimelineOptions {\n    from = from || ({} as TimelineOptions);\n    // Apply incoming options to default. (override default)\n    // Deep clone default options:\n    const to = JSON.parse(JSON.stringify(defaultTimelineOptions));\n    // Merge options with the default.\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const mergeOptionsDeep = (to: any, from: any): void => {\n      if (!to || !from) {\n        return;\n      }\n      // eslint-disable-next-line prefer-const\n      for (let key in from) {\n        if (Object.prototype.hasOwnProperty.call(from, key)) {\n          if (from[key] !== undefined) {\n            if (typeof from[key] === 'object') {\n              if (!to[key]) {\n                to[key] = from[key];\n              } else {\n                mergeOptionsDeep(to[key], from[key]);\n              }\n            } else {\n              to[key] = from[key];\n            }\n          }\n        }\n      }\n    };\n\n    mergeOptionsDeep(to, from);\n    return to;\n  }\n  /**\n   * Subscribe on time changed.\n   */\n  public onTimeChanged(callback: (eventArgs: TimelineTimeChangedEvent) => void): void {\n    this.on(TimelineEvents.TimeChanged, callback);\n  }\n  /**\n   * Subscribe on drag started event.\n   */\n  public onDragStarted(callback: (eventArgs: TimelineDragEvent) => void): void {\n    this.on(TimelineEvents.DragStarted, callback);\n  }\n  /**\n   * Subscribe on drag event.\n   */\n  public onDrag(callback: (eventArgs: TimelineDragEvent) => void): void {\n    this.on(TimelineEvents.Drag, callback);\n  }\n  /**\n   * Subscribe on drag finished event.\n   */\n  public onDragFinished(callback: (eventArgs: TimelineDragEvent) => void): void {\n    this.on(TimelineEvents.DragFinished, callback);\n  }\n  /**\n   * Subscribe on double click.\n   */\n  public onDoubleClick(callback: (eventArgs: TimelineClickEvent) => void): void {\n    this.on(TimelineEvents.DoubleClick, callback);\n  }\n  /**\n   * Subscribe on keyframe changed event.\n   */\n  public onKeyframeChanged(callback: (eventArgs: TimelineKeyframeChangedEvent) => void): void {\n    this.on(TimelineEvents.KeyframeChanged, callback);\n  }\n  /**\n   * Subscribe on drag finished event.\n   */\n  public onMouseDown(callback: (eventArgs: TimelineClickEvent) => void): void {\n    this.on(TimelineEvents.MouseDown, callback);\n  }\n\n  public onSelected(callback: (eventArgs: TimelineSelectedEvent) => void): void {\n    this.on(TimelineEvents.Selected, callback);\n  }\n  /**\n   * Subscribe on scroll event\n   */\n  public onScroll(callback: (eventArgs: TimelineScrollEvent) => void): void {\n    this.on(TimelineEvents.Scroll, callback);\n  }\n  _emitScrollEvent(args: MouseEvent | null): TimelineScrollEvent {\n    const scrollEvent = {\n      args: args,\n      scrollLeft: this.getScrollLeft(),\n      scrollTop: this.getScrollTop(),\n      scrollHeight: this._scrollContainer.scrollHeight,\n      scrollWidth: this._scrollContainer.scrollWidth,\n    } as TimelineScrollEvent;\n    super.emit(TimelineEvents.Scroll, scrollEvent);\n    return scrollEvent;\n  }\n  _emitKeyframeChanged(element: TimelineElementDragState, source: TimelineEventSource = TimelineEventSource.Programmatically): TimelineKeyframeChangedEvent {\n    const args = new TimelineKeyframeChangedEvent();\n    args.val = element.val;\n    args.prevVal = element.prevVal;\n    args.target = element;\n    args.source = source;\n    this.emit(TimelineEvents.KeyframeChanged, args);\n    return args;\n  }\n  _emitDragStartedEvent(): TimelineDragEvent {\n    const args = this._getDragEventArgs();\n    this.emit(TimelineEvents.DragStarted, args);\n    if (args.isPrevented()) {\n      this._preventDrag(args, this._drag, true);\n    }\n    return args;\n  }\n  _emitDragFinishedEvent(): TimelineDragEvent {\n    if (this._drag && this._drag.changed) {\n      const args = this._getDragEventArgs();\n      this.emit(TimelineEvents.DragFinished, args);\n      if (args.isPrevented()) {\n        this._preventDrag(args, this._drag, true);\n      }\n      return args;\n    }\n\n    return null;\n  }\n  _preventDrag(dragArgs: TimelineDragEvent, data: TimelineDraggableData, toStart = false): void {\n    if (dragArgs.elements) {\n      dragArgs.elements.forEach((element) => {\n        const toSet = toStart ? element.startedVal : element.prevVal;\n        this._setKeyframePos(element, toSet);\n      });\n    }\n    data.val = data.prevVal;\n    dragArgs.val = dragArgs.prevVal;\n  }\n  _emitDragEvent(): TimelineDragEvent {\n    if (!this._drag) {\n      return null;\n    }\n    const args = this._getDragEventArgs();\n    this.emit(TimelineEvents.Drag, args);\n    if (args.isPrevented()) {\n      this._preventDrag(args, this._drag, false);\n    }\n    return args;\n  }\n  _emitKeyframesSelected(state: TimelineSelectionResults): TimelineSelectedEvent {\n    const args = new TimelineSelectedEvent();\n    args.selected = state.selected;\n    args.changed = state.changed;\n    this.emit(TimelineEvents.Selected, args);\n    return args;\n  }\n  _getDragEventArgs(): TimelineDragEvent {\n    const draggableArguments = new TimelineDragEvent();\n    if (!this._drag) {\n      return draggableArguments;\n    }\n    draggableArguments.val = this._currentPos.val;\n    draggableArguments.originalVal = this._currentPos.originalVal;\n    draggableArguments.snapVal = this._currentPos.snapVal;\n    draggableArguments.pos = this._currentPos;\n    draggableArguments.elements = this._drag.elements;\n    draggableArguments.target = this._drag.target;\n    return draggableArguments;\n  }\n}\n","// bundle entry point\n\nexport { Timeline } from './timeline';\nexport { TimelineModel } from './timelineModel';\nexport { TimelineRow } from './timelineRow';\nexport { TimelineKeyframe } from './timelineKeyframe';\nexport { TimelineEventsEmitter } from './timelineEventsEmitter';\nexport { TimelineConsts } from './settings/timelineConsts';\nexport { TimelineRanged } from './timelineRanged';\n\n// @public styles\nexport { TimelineOptions } from './settings/timelineOptions';\nexport { TimelineKeyframeStyle } from './settings/styles/timelineKeyframeStyle';\nexport { TimelineRowStyle } from './settings/styles/timelineRowStyle';\nexport { TimelineStyle } from './settings/styles/timelineStyle';\n\nexport { TimelineStyleUtils } from './utils/timelineStyleUtils';\nexport { TimelineUtils } from './utils/timelineUtils';\nexport { TimelineElement } from './utils/timelineElement';\n\n// @private helper containers.\nexport { Selectable } from './utils/selectable';\nexport { TimelineCutBoundsRectResults } from './utils/timelineCutBoundsRectResults';\nexport { TimelineSelectionResults } from './utils/timelineSelectionResults';\nexport { TimelineValues } from './utils/timelineValues';\nexport { TimelineMouseData } from './utils/timelineMouseData';\nexport { TimelineElementDragState } from './utils/timelineDraggableData';\nexport { TimelineDraggableData } from './utils/timelineDraggableData';\n\n// @private virtual model\nexport { TimelineModelCalcResults } from './utils/timelineModelCalcResults';\nexport { TimelineCalculatedRow } from './utils/timelineModelCalcResults';\nexport { TimelineCalculatedGroup } from './utils/timelineModelCalcResults';\nexport { TimelineCalculated } from './utils/timelineModelCalcResults';\nexport { TimelineCalculatedKeyframe } from './utils/timelineModelCalcResults';\n\n// @public events\nexport { TimelineKeyframeChangedEvent } from './utils/events/timelineKeyframeChangedEvent';\nexport { TimelineTimeChangedEvent } from './utils/events/timelineTimeChangedEvent';\nexport { TimelineSelectedEvent } from './utils/events/timelineSelectedEvent';\nexport { TimelineScrollEvent } from './utils/events/timelineScrollEvent';\nexport { TimelineClickEvent } from './utils/events/timelineClickEvent';\nexport { TimelineDragEvent } from './utils/events/timelineDragEvent';\nexport { TimelineEvents } from './enums/timelineEvents';\n\n// @public enums\nexport { TimelineKeyframeShape } from './enums/timelineKeyframeShape';\nexport { TimelineInteractionMode } from './enums/timelineInteractionMode';\nexport { TimelineElementType } from './enums/timelineElementType';\nexport { TimelineCursorType } from './enums/timelineCursorType';\nexport { TimelineCapShape } from './enums/timelineCapShape';\nexport { TimelineEventSource } from './enums/timelineEventSource';\nexport { TimelineSelectionMode } from './enums/timelineSelectionMode';\n\n// @private defaults are exposed:\nexport { defaultTimelineOptions } from './settings/defaults';\nexport { defaultTimelineKeyframeStyle } from './settings/defaults';\nexport { defaultTimelineRowStyle } from './settings/defaults';\nexport { defaultTimelineStyle } from './settings/defaults';\nexport { defaultTimelineConsts } from './settings/defaults';\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(741);\n"],"sourceRoot":""}